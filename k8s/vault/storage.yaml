---
# Storage Class for Vault (if using cloud provider)
# Uncomment and modify based on your cloud provider
# apiVersion: storage.k8s.io/v1
# kind: StorageClass
# metadata:
#   name: fast-ssd
# provisioner: kubernetes.io/gce-pd  # For GKE
# # provisioner: kubernetes.io/aws-ebs  # For EKS
# # provisioner: kubernetes.io/azure-disk  # For AKS
# parameters:
#   type: pd-ssd  # GKE
#   # type: gp3  # EKS
#   # storageaccounttype: Premium_LRS  # AKS
# allowVolumeExpansion: true
# reclaimPolicy: Retain
# volumeBindingMode: WaitForFirstConsumer

---
# PersistentVolume for Vault (hostPath for local/dev, use cloud storage for prod)
apiVersion: v1
kind: PersistentVolume
metadata:
  name: vault-storage-0
  labels:
    app: vault
    component: storage
spec:
  capacity:
    storage: 50Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  # For production, use a StorageClass appropriate for your cloud provider
  # storageClassName: fast-ssd
  hostPath:
    path: /data/vault-0
    type: DirectoryOrCreate
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - node-0  # Replace with actual node name

---
# PersistentVolume for Vault HA replica 1
apiVersion: v1
kind: PersistentVolume
metadata:
  name: vault-storage-1
  labels:
    app: vault
    component: storage
spec:
  capacity:
    storage: 50Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  hostPath:
    path: /data/vault-1
    type: DirectoryOrCreate
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - node-1  # Replace with actual node name

---
# PersistentVolume for Vault HA replica 2
apiVersion: v1
kind: PersistentVolume
metadata:
  name: vault-storage-2
  labels:
    app: vault
    component: storage
spec:
  capacity:
    storage: 50Gi
  accessModes:
    - ReadWriteOnce
  persistentVolumeReclaimPolicy: Retain
  hostPath:
    path: /data/vault-2
    type: DirectoryOrCreate
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - node-2  # Replace with actual node name

---
# PersistentVolumeClaim for Vault
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: vault-storage
  namespace: vault
  labels:
    app: vault
spec:
  accessModes:
    - ReadWriteOnce
  # For production, use a StorageClass
  # storageClassName: fast-ssd
  resources:
    requests:
      storage: 50Gi
  selector:
    matchLabels:
      app: vault
      component: storage