# MaaS Helm Chart - Production Environment Values
# ================================================
# Override values for production deployment.
# Usage: helm install maas deploy/helm/maas -f deploy/helm/maas/values-production.yaml

global:
  environment: "production"
  imageRegistry: ""  # Set to your production registry
  imagePullSecrets:
    - name: registry-credentials

# API Server - Production Configuration
api:
  replicaCount: 3
  
  image:
    repository: maas-x0tta6bl4/api
    pullPolicy: Always
    tag: ""  # Use chart appVersion
  
  service:
    type: ClusterIP
    port: 8080
    targetPort: 8080
    annotations:
      prometheus.io/scrape: "true"
      prometheus.io/port: "8080"
  
  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/ssl-redirect: "true"
      nginx.ingress.kubernetes.io/proxy-body-size: "25m"
      nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
      nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
      nginx.ingress.kubernetes.io/rate-limit: "100"
      nginx.ingress.kubernetes.io/rate-limit-window: "1m"
      cert-manager.io/cluster-issuer: "letsencrypt-production"
    hosts:
      - host: api.maas-x0tta6bl4.local
        paths:
          - path: /
            pathType: Prefix
    tls:
      - secretName: maas-api-production-tls
        hosts:
          - api.maas-x0tta6bl4.local
  
  resources:
    limits:
      cpu: 2000m
      memory: 2Gi
    requests:
      cpu: 500m
      memory: 1Gi
  
  autoscaling:
    enabled: true
    minReplicas: 3
    maxReplicas: 20
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 75
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 300
        policies:
          - type: Percent
            value: 10
            periodSeconds: 60
      scaleUp:
        stabilizationWindowSeconds: 0
        policies:
          - type: Percent
            value: 100
            periodSeconds: 15
          - type: Pods
            value: 4
            periodSeconds: 15
        selectPolicy: Max
  
  podDisruptionBudget:
    enabled: true
    minAvailable: 2

# Controller - Production Configuration
controller:
  replicaCount: 2
  
  image:
    repository: maas-x0tta6bl4/controller
    pullPolicy: Always
    tag: ""
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70

# Worker - Production Configuration
worker:
  replicaCount: 5
  
  image:
    repository: maas-x0tta6bl4/worker
    pullPolicy: Always
    tag: ""
  
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 250m
      memory: 512Mi
  
  concurrency: 8
  queues: "default,provisioning,billing,notifications,critical"
  
  autoscaling:
    enabled: true
    minReplicas: 5
    maxReplicas: 50
    targetCPUUtilizationPercentage: 60
    behavior:
      scaleDown:
        stabilizationWindowSeconds: 600
      scaleUp:
        stabilizationWindowSeconds: 30

# SPIRE - Production Configuration
spire:
  enabled: true
  
  server:
    replicaCount: 3
    resources:
      limits:
        cpu: 1000m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi
  
  agent:
    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 100m
        memory: 128Mi

# PostgreSQL - Production Configuration
postgresql:
  enabled: true
  
  auth:
    postgresPassword: ""  # Set via external secrets
    username: "maas"
    password: ""  # Set via external secrets
    database: "maas_production"
  
  primary:
    persistence:
      enabled: true
      size: 100Gi
      storageClass: "fast-ssd"
    
    resources:
      limits:
        cpu: 4000m
        memory: 8Gi
      requests:
        cpu: 1000m
        memory: 4Gi
    
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchLabels:
                app.kubernetes.io/component: primary
            topologyKey: kubernetes.io/hostname
  
  readReplicas:
    enabled: true
    replicaCount: 2
    persistence:
      enabled: true
      size: 50Gi
      storageClass: "fast-ssd"

# Redis - Production Configuration
redis:
  enabled: true
  
  auth:
    enabled: true
    password: ""  # Set via external secrets
  
  master:
    persistence:
      enabled: true
      size: 10Gi
      storageClass: "fast-ssd"
    
    resources:
      limits:
        cpu: 1000m
        memory: 2Gi
      requests:
        cpu: 250m
        memory: 1Gi
  
  replica:
    enabled: true
    replicaCount: 2
    persistence:
      enabled: true
      size: 5Gi
    
    resources:
      limits:
        cpu: 500m
        memory: 1Gi
      requests:
        cpu: 100m
        memory: 512Mi

# Prometheus - Production Configuration
prometheus:
  enabled: true
  
  server:
    retention: "30d"
    persistence:
      enabled: true
      size: 50Gi
      storageClass: "standard"
    
    resources:
      limits:
        cpu: 2000m
        memory: 8Gi
      requests:
        cpu: 500m
        memory: 2Gi
  
  alertmanager:
    enabled: true
    persistence:
      enabled: true
      size: 5Gi
  
  serviceMonitor:
    enabled: true
    interval: "30s"
    scrapeTimeout: "10s"
  
  rules:
    enabled: true

# Grafana - Production Configuration
grafana:
  enabled: true
  
  adminPassword: ""  # Set via external secrets
  
  persistence:
    enabled: true
    size: 10Gi
    storageClass: "standard"
  
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 100m
      memory: 256Mi
  
  ingress:
    enabled: true
    hosts:
      - grafana.maas-x0tta6bl4.local
    tls:
      - secretName: grafana-tls
        hosts:
          - grafana.maas-x0tta6bl4.local

# Stripe - Production Configuration
stripe:
  enabled: true
  secretKey: ""  # Set via external secrets (sk_live_xxx)
  webhookSecret: ""  # Set via external secrets
  
  webhook:
    enabled: true
    path: /webhooks/stripe

# Feature Flags - Production
features:
  pqcEnabled: true
  meshProvisioning: true
  usageMetering: true
  billingIntegration: true
  federatedLearning: false
  anomalyDetection: true

# Logging - Production
logging:
  level: "INFO"
  format: "json"
  output: "stdout"
  
  structured:
    enabled: true
    includeTimestamp: true
    includeRequestId: true
    includeUserId: true

# Tracing - Production
tracing:
  enabled: true
  exporter:
    type: "otlp"
    endpoint: "http://otel-collector:4317"
  sampling:
    type: "probabilistic"
    rate: 0.1  # 10% sampling

# Network Policies - Production
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: ingress-nginx
        - namespaceSelector:
            matchLabels:
              name: monitoring
      ports:
        - protocol: TCP
          port: 8080
  egress:
    - to:
        - namespaceSelector: {}
      ports:
        - protocol: TCP
          port: 5432
        - protocol: TCP
          port: 6379
        - protocol: TCP
          port: 443

# Istio-like profile - production
istioLike:
  enabled: true
  authorization:
    enabled: false
  routing:
    defaultSubsetLabelValue: stable
    canaryWeight: 0
  virtualService:
    timeout: 2s
    retries:
      attempts: 2
      perTryTimeout: 700ms

# Pod Anti-Affinity - Production
podAntiAffinity:
  enabled: true
  topologyKey: "kubernetes.io/hostname"

# Service Account - Production
serviceAccount:
  create: true
  annotations:
    "eks.amazonaws.com/role-arn": ""  # Set to production IAM role

# External Secrets - Production
secrets:
  create: false  # Use external secrets operator
  external:
    enabled: true
    secretStore: "aws-secretsmanager"
    refreshInterval: "1h"

# Priority Class - Production
priorityClassName: "high-priority"

# Node Selector - Production
nodeSelector:
  environment: production

# Tolerations - Production
tolerations:
  - key: "environment"
    operator: "Equal"
    value: "production"
    effect: "NoSchedule"
  - key: "dedicated"
    operator: "Equal"
    value: "maas"
    effect: "NoSchedule"

# Topology Spread Constraints
topologySpreadConstraints:
  - maxSkew: 1
    topologyKey: topology.kubernetes.io/zone
    whenUnsatisfiable: ScheduleAnyway
    labelSelector:
      matchLabels:
        app.kubernetes.io/name: maas
