{
  "dashboard": {
    "title": "x0tta6bl4 Enhanced Monitoring",
    "tags": ["x0tta6bl4", "mesh", "self-healing", "security", "production", "enhanced"],
    "timezone": "browser",
    "refresh": "30s",
    "time": {
      "from": "now-1h",
      "to": "now"
    },
    "templating": {
      "list": [
        {
          "name": "node_id",
          "type": "query",
          "query": "label_values(x0tta6bl4_mesh_nodes_total, node_id)",
          "current": {
            "value": "all",
            "text": "All"
          },
          "options": [
            {
              "value": "all",
              "text": "All"
            }
          ],
          "multi": true,
          "includeAll": true
        },
        {
          "name": "service",
          "type": "query",
          "query": "label_values(http_requests_total, service)",
          "current": {
            "value": "all",
            "text": "All"
          },
          "multi": true,
          "includeAll": true
        },
        {
          "name": "time_range",
          "type": "interval",
          "query": "1m,5m,15m,30m,1h,6h,12h,24h",
          "current": {
            "value": "1h",
            "text": "1h"
          }
        }
      ]
    },
    "panels": [
      {
        "id": 1,
        "title": "Mesh Network Health (Custom Panel)",
        "type": "graph",
        "gridPos": {"x": 0, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum(x0tta6bl4_mesh_nodes_total) by (node_id)",
            "legendFormat": "{{node_id}}",
            "refId": "A"
          },
          {
            "expr": "sum(x0tta6bl4_mesh_connections_active) by (node_id)",
            "legendFormat": "Connections {{node_id}}",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.95, rate(x0tta6bl4_mesh_latency_seconds_bucket[$time_range]))",
            "legendFormat": "P95 Latency",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "short", "label": "Count"},
          {"format": "s", "label": "Seconds"}
        ],
        "alert": {
          "conditions": [
            {
              "evaluator": {
                "params": [10],
                "type": "gt"
              },
              "operator": {
                "type": "and"
              },
              "query": {
                "params": ["A", "5m", "now"]
              },
              "reducer": {
                "params": [],
                "type": "last"
              },
              "type": "query"
            }
          ],
          "executionErrorState": "alerting",
          "for": "5m",
          "frequency": "10s",
          "handler": 1,
          "name": "High Mesh Latency",
          "noDataState": "no_data",
          "notifications": []
        }
      },
      {
        "id": 2,
        "title": "MAPE-K Cycle Performance",
        "type": "graph",
        "gridPos": {"x": 12, "y": 0, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(x0tta6bl4_mape_k_cycle_duration_seconds_bucket[$time_range])) by (phase)",
            "legendFormat": "P95 {{phase}}",
            "refId": "A"
          },
          {
            "expr": "rate(x0tta6bl4_mapek_incidents_detected_total[$time_range])",
            "legendFormat": "Incidents/sec",
            "refId": "B"
          },
          {
            "expr": "histogram_quantile(0.95, rate(x0tta6bl4_self_healing_mttr_seconds_bucket[$time_range]))",
            "legendFormat": "P95 MTTR",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "Seconds"},
          {"format": "short", "label": "Rate"}
        ]
      },
      {
        "id": 3,
        "title": "Security Events & PQC Metrics",
        "type": "graph",
        "gridPos": {"x": 0, "y": 8, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "rate(x0tta6bl4_pqc_handshake_failure_total[$time_range]) by (reason)",
            "legendFormat": "PQC Failures: {{reason}}",
            "refId": "A"
          },
          {
            "expr": "x0tta6bl4_pqc_fallback_enabled",
            "legendFormat": "PQC Fallback Enabled",
            "refId": "B"
          },
          {
            "expr": "rate(x0tta6bl4_spiffe_identity_expiry_warnings[$time_range])",
            "legendFormat": "SPIFFE Expiry Warnings",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "short", "label": "Count"},
          {"format": "short", "label": "Count"}
        ],
        "alert": {
          "conditions": [
            {
              "evaluator": {
                "params": [0],
                "type": "gt"
              },
              "operator": {
                "type": "and"
              },
              "query": {
                "params": ["A", "5m", "now"]
              },
              "reducer": {
                "params": [],
                "type": "last"
              },
              "type": "query"
            }
          ],
          "executionErrorState": "alerting",
          "for": "1m",
          "frequency": "10s",
          "handler": 1,
          "name": "PQC Handshake Failure",
          "noDataState": "no_data",
          "notifications": []
        }
      },
      {
        "id": 4,
        "title": "Resource Utilization",
        "type": "graph",
        "gridPos": {"x": 12, "y": 8, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "x0tta6bl4_cpu_percent",
            "legendFormat": "CPU {{node_id}}",
            "refId": "A"
          },
          {
            "expr": "x0tta6bl4_memory_percent",
            "legendFormat": "Memory {{node_id}}",
            "refId": "B"
          },
          {
            "expr": "x0tta6bl4_network_throughput_bytes",
            "legendFormat": "Network {{node_id}}",
            "refId": "C"
          }
        ],
        "yaxes": [
          {"format": "percent", "label": "Percent"},
          {"format": "bytes", "label": "Bytes/sec"}
        ]
      },
      {
        "id": 5,
        "title": "Error Rates by Service",
        "type": "graph",
        "gridPos": {"x": 0, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "sum(rate(http_requests_total{status=~\"5..\"}[$time_range])) by (service) / sum(rate(http_requests_total[$time_range])) by (service)",
            "legendFormat": "Error Rate {{service}}",
            "refId": "A"
          },
          {
            "expr": "sum(rate(x0tta6bl4_errors_total[$time_range])) by (error_type, context)",
            "legendFormat": "{{error_type}} in {{context}}",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "percent", "label": "Error Rate"},
          {"format": "short", "label": "Count/sec"}
        ]
      },
      {
        "id": 6,
        "title": "OpenTelemetry Traces",
        "type": "graph",
        "gridPos": {"x": 12, "y": 16, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "histogram_quantile(0.95, rate(trace_duration_seconds_bucket[$time_range])) by (service_name, operation)",
            "legendFormat": "P95 {{service_name}}/{{operation}}",
            "refId": "A"
          },
          {
            "expr": "rate(trace_spans_total[$time_range]) by (service_name)",
            "legendFormat": "Spans/sec {{service_name}}",
            "refId": "B"
          }
        ],
        "yaxes": [
          {"format": "s", "label": "Seconds"},
          {"format": "short", "label": "Spans/sec"}
        ]
      },
      {
        "id": 7,
        "title": "Raft Consensus Status",
        "type": "stat",
        "gridPos": {"x": 0, "y": 24, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "x0tta6bl4_raft_leader",
            "legendFormat": "Leader",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          },
          "textMode": "auto"
        }
      },
      {
        "id": 8,
        "title": "CRDT Sync Status",
        "type": "stat",
        "gridPos": {"x": 6, "y": 24, "w": 6, "h": 4},
        "targets": [
          {
            "expr": "x0tta6bl4_crdt_sync_success_rate",
            "legendFormat": "Success Rate",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          },
          "textMode": "auto"
        }
      },
      {
        "id": 9,
        "title": "Recovery Actions",
        "type": "table",
        "gridPos": {"x": 12, "y": 24, "w": 12, "h": 8},
        "targets": [
          {
            "expr": "x0tta6bl4_recovery_actions_total",
            "format": "table",
            "instant": true,
            "refId": "A"
          }
        ],
        "transformations": [
          {
            "id": "organize",
            "options": {
              "excludeByName": {
                "Time": true
              },
              "indexByName": {},
              "renameByName": {
                "Value": "Count",
                "action_type": "Action Type",
                "node_id": "Node ID"
              }
            }
          }
        ]
      },
      {
        "id": 10,
        "title": "Circuit Breaker Status",
        "type": "stat",
        "gridPos": {"x": 0, "y": 28, "w": 8, "h": 4},
        "targets": [
          {
            "expr": "x0tta6bl4_circuit_breaker_state",
            "legendFormat": "State",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          },
          "textMode": "auto"
        },
        "fieldConfig": {
          "defaults": {
            "mappings": [
              {
                "options": {
                  "0": {
                    "text": "Closed",
                    "color": "green"
                  },
                  "1": {
                    "text": "Open",
                    "color": "red"
                  },
                  "2": {
                    "text": "Half-Open",
                    "color": "yellow"
                  }
                },
                "type": "value"
              }
            ]
          }
        }
      },
      {
        "id": 11,
        "title": "Rate Limiter Status",
        "type": "stat",
        "gridPos": {"x": 8, "y": 28, "w": 8, "h": 4},
        "targets": [
          {
            "expr": "x0tta6bl4_rate_limiter_current_actions",
            "legendFormat": "Current Actions",
            "refId": "A"
          }
        ],
        "options": {
          "colorMode": "value",
          "graphMode": "area",
          "justifyMode": "auto",
          "orientation": "auto",
          "reduceOptions": {
            "values": false,
            "calcs": ["lastNotNull"],
            "fields": ""
          },
          "textMode": "auto"
        }
      },
      {
        "id": 12,
        "title": "Alert Summary",
        "type": "alertlist",
        "gridPos": {"x": 16, "y": 28, "w": 8, "h": 8},
        "targets": [
          {
            "refId": "A",
            "queryType": "",
            "datasource": {
              "type": "prometheus",
              "uid": "prometheus"
            }
          }
        ],
        "options": {
          "show": "current",
          "sortOrder": 1,
          "folderId": null,
          "dashboardTags": []
        }
      }
    ],
    "annotations": {
      "list": [
        {
          "name": "Deployments",
          "datasource": {
            "type": "prometheus",
            "uid": "prometheus"
          },
          "enable": true,
          "iconColor": "rgba(0, 211, 255, 1)",
          "tags": ["deployment"],
          "type": "tags"
        }
      ]
    },
    "links": [
      {
        "title": "Alerting Rules",
        "type": "link",
        "url": "/alerting/list",
        "icon": "external link",
        "tooltip": "View alerting rules"
      },
      {
        "title": "Jaeger Traces",
        "type": "link",
        "url": "http://jaeger:16686",
        "icon": "external link",
        "tooltip": "View distributed traces"
      }
    ],
    "version": 1,
    "schemaVersion": 38
  }
}

