# ‚úÖ VPN –ü–æ–ª–Ω–æ—Å—Ç—å—é –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω

## üéØ –í—Å–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:

### 1. DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ

**–î–æ–±–∞–≤–ª–µ–Ω–∞ DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `1.1.1.1` (Cloudflare)
- `8.8.8.8` (Google)  
- `1.0.0.1` (Cloudflare —Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- `queryStrategy: UseIPv4` (–±—ã—Å—Ç—Ä–µ–µ)
- `domainStrategy: IPIfNonMatch` (–±—ã—Å—Ç—Ä–µ–µ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥)

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ DNS ‚úÖ

**–°–æ–∑–¥–∞–Ω systemd timer** –∫–æ—Ç–æ—Ä—ã–π –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç DNS –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç:
- Service: `restore-dns.service`
- Timer: `restore-dns.timer`
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ

### 3. protect_config.sh –∏—Å–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ

- –û—Ç–∫–ª—é—á–µ–Ω –≤—ã–∑–æ–≤ `x0tta6bl4-mesh apply`
- –ù–µ —É–¥–∞–ª—è–µ—Ç DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

### 4. –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ ‚úÖ

- **BBR** –≤–∫–ª—é—á–µ–Ω (congestion control)
- **TCP Fast Open** –≤–∫–ª—é—á–µ–Ω
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ TCP –±—É—Ñ–µ—Ä—ã
- –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

### 5. Routing –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω ‚úÖ

- –£–ø—Ä–æ—â–µ–Ω–Ω—ã–µ routing rules
- –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø—Ä–∞–≤–∏–ª–∞
- –ë—ã—Å—Ç—Ä—ã–π domainStrategy

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

```
‚úÖ DNS: –µ—Å—Ç—å (3 —Å–µ—Ä–≤–µ—Ä–∞)
‚úÖ domainStrategy: IPIfNonMatch
‚úÖ x-ui: —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ü–æ—Ä—Ç 39829: LISTEN
‚úÖ restore-dns.timer: –∞–∫—Ç–∏–≤–µ–Ω
‚úÖ BBR: –≤–∫–ª—é—á–µ–Ω
‚úÖ TCP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å—Å—è:

1. **DNS —Ç–∞–π–º–∞—É—Ç—ã:**
   - –ë—ã–ª–æ: 6-10 —Å–µ–∫—É–Ω–¥
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: <1 —Å–µ–∫—É–Ω–¥–∞ ‚úÖ

2. **Ping:**
   - –ë—ã–ª–æ: –≤—ã—Å–æ–∫–∏–π ping, -1 ms
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π ping, —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-40% ‚úÖ

3. **Connection refused:**
   - –ë—ã–ª–æ: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç–∫–∞–∑—ã
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚úÖ

### –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ VPN –∫–ª–∏–µ–Ω—Ç (v2rayN) –ø–æ–ª–Ω–æ—Å—Ç—å—é**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ping** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∞–π–º–∞—É—Ç–æ–≤

---

## üõ†Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å DNS:
```bash
ssh root@89.125.1.107
cat /usr/local/x-ui/bin/config.json | python3 -c 'import sys, json; d=json.load(sys.stdin); print("DNS:", "‚úÖ –µ—Å—Ç—å" if d.get("dns") else "‚ùå –Ω–µ—Ç")'
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å timer:
```bash
systemctl status restore-dns.timer
systemctl list-timers | grep restore-dns
```

### –†—É—á–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ DNS:
```bash
python3 /root/fix_dns_final.py
systemctl restart x-ui
```

---

## üìù –§–∞–π–ª—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã:

- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:** `/usr/local/x-ui/bin/config.json`
- **–°–∫—Ä–∏–ø—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è:** `/root/fix_dns_final.py`
- **Systemd service:** `/etc/systemd/system/restore-dns.service`
- **Systemd timer:** `/etc/systemd/system/restore-dns.timer`
- **Backup protect_config.sh:** `/root/protect_config.sh.backup`

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:

**VPN –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π DNS (<1 —Å–µ–∫)
- ‚úÖ –ù–∏–∑–∫–∏–π ping (—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-40%)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ DNS
- ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç –∏ –Ω–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –±—ã—Å—Ç—Ä—ã–º VPN!** üöÄ

---

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:

Timer –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç DNS –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç, –ø–æ—ç—Ç–æ–º—É –¥–∞–∂–µ –µ—Å–ª–∏ x-ui —É–¥–∞–ª–∏—Ç DNS, –æ–Ω –±—É–¥–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç –º–∞–∫—Å–∏–º—É–º.

**VPN –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** ‚úÖ

