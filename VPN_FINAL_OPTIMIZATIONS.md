# üöÄ –§–∏–Ω–∞–ª—å–Ω—ã–µ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ VPN –°–µ—Ä–≤–µ—Ä–∞

## ‚úÖ –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 - –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –£–ª—É—á—à–µ–Ω–∏—è (–ü—Ä–∏–º–µ–Ω–µ–Ω—ã)

### 1. **DPI –ó–∞—â–∏—Ç–∞** ‚úÖ

**–†–∞—Å—à–∏—Ä–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —Ç—Ä–∞—Ñ–∏–∫–∞:**

- ‚úÖ **SNI –¥–æ–º–µ–Ω–æ–≤:** –†–∞—Å—à–∏—Ä–µ–Ω –¥–æ 14+ –¥–æ–º–µ–Ω–æ–≤
  - www.google.com, google.com
  - www.youtube.com, youtube.com
  - www.cloudflare.com, cloudflare.com
  - www.microsoft.com, microsoft.com
  - fonts.googleapis.com, fonts.gstatic.com
  - –ò –¥—Ä—É–≥–∏–µ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ –¥–æ–º–µ–Ω—ã

- ‚úÖ **maxTimediff:** –£–≤–µ–ª–∏—á–µ–Ω –¥–æ 300 —Å–µ–∫—É–Ω–¥ (–±—ã–ª–æ 60)
  - –õ—É—á—à–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏
  - –ú–µ–Ω—å—à–µ –ø—Ä–æ–±–ª–µ–º —Å —á–∞—Å–æ–≤—ã–º–∏ –ø–æ—è—Å–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –¢—Ä–∞—Ñ–∏–∫ –ª—É—á—à–µ –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –æ–±—ã—á–Ω—ã–π HTTPS

---

### 2. **Rate Limiting** ‚úÖ

**–ó–∞—â–∏—Ç–∞ –æ—Ç DDoS –∞—Ç–∞–∫:**

```bash
ufw limit 39829/tcp  # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π –∫ VPN
ufw limit 22/tcp    # –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —Å–µ—Ä–≤–µ—Ä–∞

---

### 3. **Log Rotation** ‚úÖ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤:**

```bash
/etc/logrotate.d/xray
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –†–æ—Ç–∞—Ü–∏—è: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ
- –•—Ä–∞–Ω–µ–Ω–∏–µ: 7 –¥–Ω–µ–π
- –°–∂–∞—Ç–∏–µ: –≤–∫–ª—é—á–µ–Ω–æ
- –ü—Ä–∞–≤–∞: 0640 (nobody:nobody)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –õ–æ–≥–∏ –Ω–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

---

### 4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ë—ç–∫–∞–ø—ã** ‚úÖ

**–ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**

```bash
/root/backup_config.sh
```

**–ù–∞—Å—Ç—Ä–æ–π–∫–∏:**
- –í—Ä–µ–º—è: 02:00 –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
- –•—Ä–∞–Ω–µ–Ω–∏–µ: 30 –¥–Ω–µ–π
- –õ–æ–∫–∞—Ü–∏—è: `/root/backups/`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

---

## üìä –°—Ç–∞—Ç—É—Å –£–ª—É—á—à–µ–Ω–∏–π

| –£–ª—É—á—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç |
|-----------|--------|-----------|
| DPI –∑–∞—â–∏—Ç–∞ (SNI) | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Rate limiting | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Log rotation | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã | ‚úÖ | üî¥ –ö—Ä–∏—Ç–∏—á–Ω–æ |
| Grafana | ‚è≥ | üü° –í–∞–∂–Ω–æ |
| Telegram alerts | ‚è≥ | üü° –í–∞–∂–Ω–æ |
| WireGuard | ‚è≥ | üü† –£–ª—É—á—à–µ–Ω–∏–µ |
| Load balancing | ‚è≥ | üü† –£–ª—É—á—à–µ–Ω–∏–µ |
| IPv6 | ‚è≥ | üü† –£–ª—É—á—à–µ–Ω–∏–µ |

---

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –î–µ—Ç–∞–ª–∏

### DPI –ó–∞—â–∏—Ç–∞:

**–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ SNI:**
```json
{
  "realitySettings": {
    "serverNames": [
      "www.google.com", "google.com",
      "www.youtube.com", "youtube.com",
      "www.cloudflare.com", "cloudflare.com",
      "www.microsoft.com", "microsoft.com",
      "fonts.googleapis.com", "fonts.gstatic.com",
      "www.gstatic.com", "static.google.com",
      "ajax.googleapis.com", "accounts.google.com",
      "clients4.google.com", "www.google-analytics.com"
    ],
    "maxTimediff": 300
  }
}
```

### Rate Limiting:

```bash
# UFW –ø—Ä–∞–≤–∏–ª–∞
ufw limit 39829/tcp  # VPN –ø–æ—Ä—Ç
ufw limit 22/tcp    # SSH –ø–æ—Ä—Ç
```

### Log Rotation:

```bash
# /etc/logrotate.d/xray
/var/log/xray/*.log {
    daily
    rotate 7
    compress
    delaycompress
    notifempty
    create 0640 nobody nobody
}
```

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ë—ç–∫–∞–ø—ã:

```bash
# Crontab
0 2 * * * /root/backup_config.sh

# –°–∫—Ä–∏–ø—Ç
/root/backup_config.sh
# –°–æ–∑–¥–∞–µ—Ç: /root/backups/config_YYYYMMDD_HHMMSS.json
# –£–¥–∞–ª—è–µ—Ç: –±—ç–∫–∞–ø—ã —Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π
```

---

## üìã –°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ (–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2)

### 1. **Grafana** (15 –º–∏–Ω—É—Ç)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Grafana –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Ç—Ä–∏–∫
docker run -d \
  --name grafana \
  -p 3000:3000 \
  -e "GF_SECURITY_ADMIN_PASSWORD=admin123" \
  grafana/grafana:latest

# –î–æ—Å—Ç—É–ø: http://89.125.1.107:3000
# Login: admin/admin123
```

### 2. **Telegram –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (20 –º–∏–Ω—É—Ç)

```bash
# –°–æ–∑–¥–∞—Ç—å –±–æ—Ç–∞ –≤ @BotFather
# –ü–æ–ª—É—á–∏—Ç—å token –∏ chat_id
# –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
```

### 3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –î–∏—Å–∫–∞**

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞
df -h

# –ï—Å–ª–∏ > 80%, –æ—á–∏—Å—Ç–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –ª–æ–≥–∏
find /var/log -name "*.log" -mtime +7 -delete
```

---

## üéØ –ò—Ç–æ–≥

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1 (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ):** ‚úÖ **–í–°–ï –ü–†–ò–ú–ï–ù–ï–ù–´**

- ‚úÖ DPI –∑–∞—â–∏—Ç–∞ —É–ª—É—á—à–µ–Ω–∞ (14+ SNI –¥–æ–º–µ–Ω–æ–≤)
- ‚úÖ Rate limiting –≤–∫–ª—é—á–µ–Ω
- ‚úÖ Log rotation –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã —Ä–∞–±–æ—Ç–∞—é—Ç

**–°–∏—Å—Ç–µ–º–∞:** ‚úÖ **–ì–û–¢–û–í–ê –ö –ü–†–û–î–ê–ö–®–ï–ù–£**

---

## üìù –§–∞–π–ª—ã

**–°–∫—Ä–∏–ø—Ç—ã:**
- `/root/final_optimization.sh` - –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- `/root/backup_config.sh` - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –±—ç–∫–∞–ø—ã
- `/root/improve_dpi_protection.py` - –£–ª—É—á—à–µ–Ω–∏–µ DPI –∑–∞—â–∏—Ç—ã

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:**
- `/usr/local/etc/xray/config.json` - –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥
- `/etc/logrotate.d/xray` - –†–æ—Ç–∞—Ü–∏—è –ª–æ–≥–æ–≤
- `/root/backups/` - –ë—ç–∫–∞–ø—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**Crontab:**
- `0 2 * * * /root/backup_config.sh` - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –±—ç–∫–∞–ø—ã

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
systemctl status xray
systemctl status restore-dns.timer

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—ç–∫–∞–ø—ã
ls -lh /root/backups/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
ls -lh /var/log/xray/

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rate limiting
ufw status | grep 39829
```

---

## üéâ –†–µ–∑—É–ª—å—Ç–∞—Ç

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã!**

–°–µ—Ä–≤–µ—Ä —Ç–µ–ø–µ—Ä—å:
- ‚úÖ –ó–∞—â–∏—â–µ–Ω –æ—Ç DPI –∞—Ç–∞–∫
- ‚úÖ –ó–∞—â–∏—â–µ–Ω –æ—Ç DDoS (rate limiting)
- ‚úÖ –õ–æ–≥–∏ –Ω–µ –∑–∞–Ω–∏–º–∞—é—Ç –º–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—ç–∫–∞–ø–∏—Ç—Å—è

**–ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ

