# Оптимизированные параметры BATMAN-adv для многорегиональной сети

global:
  imageRegistry: ""
  imagePullSecrets: []
  storageClass: ""

# Конфигурация BATMAN-adv
batmanAdv:
  image:
    repository: batman-adv/batman-adv-optimized
    tag: "1.0.0"
    pullPolicy: IfNotPresent

  # Оптимизированные параметры производительности
  config:
    # Multi-path маршрутизация
    multipath:
      enabled: true
      maxPaths: 3
      pathDiscoveryInterval: "5s"
      pathFailureThreshold: 3

    # AODV fallback параметры
    aodv:
      enabled: true
      fallbackTimeout: "15s"
      routeRequestRetries: 3
      routeRequestRateLimit: "10/s"

    # Оптимизированные тайм-ауты
    timeouts:
      originatorInterval: "1s"          # Уменьшено с 3s для быстрого обнаружения
      echoInterval: "500ms"             # Оптимизировано для снижения задержек
      routeRecordTimeout: "10s"         # Увеличено для стабильности

    # Буферизация пакетов
    buffering:
      maxQueueLength: 1000              # Увеличено для обработки пиковых нагрузок
      packetBufferTimeout: "100ms"      # Оптимизировано для снижения задержек
      retransmissionBufferSize: 50      # Увеличено для надежности

    # Параметры обнаружения соседей
    neighborDiscovery:
      neighborTimeout: "5s"             # Оптимизировано для быстрого восстановления
      neighborAgingTime: "30s"          # Увеличено для стабильности

  # Мониторинг производительности
  monitoring:
    enabled: true
    prometheus:
      enabled: true
      scrapeInterval: "15s"
      metricsPort: 9091

    # Детальные метрики маршрутизации
    metrics:
      routeFlaps: true                  # Мониторинг flapping маршрутов
      pathUtilization: true             # Использование multi-path
      neighborStability: true           # Стабильность соседей
      packetLoss: true                  # Потери пакетов по путям

  # Региональная конфигурация
  regions:
    us-east:
      gatewayNodes: 3
      backupPaths: 2
      priority: 1

    eu-west:
      gatewayNodes: 3
      backupPaths: 2
      priority: 2

    asia-pacific:
      gatewayNodes: 2
      backupPaths: 1
      priority: 3

# Конфигурация DaemonSet для mesh узлов
daemonSet:
  enabled: true
  hostNetwork: true
  dnsPolicy: ClusterFirstWithHostNet

  # Аннотации для безопасности
  podAnnotations:
    prometheus.io/scrape: "true"
    prometheus.io/port: "9091"

  # Ресурсы для производительности
  resources:
    limits:
      cpu: "500m"
      memory: "256Mi"
    requests:
      cpu: "100m"
      memory: "128Mi"

  # Health checks
  livenessProbe:
    exec:
      command:
        - batctl
        - gateway
        - status
    initialDelaySeconds: 30
    periodSeconds: 10

  readinessProbe:
    exec:
      command:
        - batctl
        - originators
    initialDelaySeconds: 15
    periodSeconds: 5

# Service для мониторинга
service:
  enabled: true
  type: ClusterIP
  ports:
    - name: metrics
      port: 9091
      targetPort: 9091
      protocol: TCP

# ConfigMap для дополнительных конфигураций
configMap:
  enabled: true
  data:
    batman-adv.conf: |
      # Оптимизированная конфигурация BATMAN-adv
      originator_interval 1000
      echo_interval 500
      route_record_timeout 10000

      # Multi-path параметры
      multipath_mode 1
      multipath_max_paths 3

      # AODV параметры
      aodv_fallback_timeout 15000
      aodv_max_retries 3

# NetworkPolicy для безопасности
networkPolicy:
  enabled: true
  ingress:
    - from:
        - namespaceSelector:
            matchLabels:
              name: monitoring
        - podSelector:
            matchLabels:
              app: batman-adv-optimization
      ports:
        - protocol: TCP
          port: 9091

# Persistence для логов и метрик
persistence:
  enabled: false
  accessModes:
    - ReadWriteOnce
  size: 10Gi
  storageClass: ""

# Автомасштабирование (если требуется)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70