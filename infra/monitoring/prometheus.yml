# Prometheus configuration for x0tta6bl4 mesh monitoring
# Scrapes metrics from all 3 mesh nodes + Prometheus self-monitoring

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    cluster: 'x0tta6bl4-mesh'
    environment: 'development'

# Alerting configuration
alerting:
  alertmanagers:
    - static_configs:
        - targets: ['alertmanager:9093']

# Scrape configurations
scrape_configs:
  # Prometheus self-monitoring
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

  # x0tta6bl4 mesh nodes
  - job_name: 'x0tta6bl4-mesh'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets:
          - 'node-a:8000'
          - 'node-b:8000'
          - 'node-c:8000'
        labels:
          mesh_cluster: 'primary'
          project: 'x0tta6bl4'

  # Per-node monitoring with custom labels
  - job_name: 'x0tta6bl4-node-a'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['node-a:8000']
        labels:
          node_id: 'node-a'
          node_role: 'primary'

  - job_name: 'x0tta6bl4-node-b'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['node-b:8000']
        labels:
          node_id: 'node-b'
          node_role: 'secondary'

  - job_name: 'x0tta6bl4-node-c'
    scrape_interval: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['node-c:8000']
        labels:
          node_id: 'node-c'
          node_role: 'tertiary'

  # eBPF telemetry metrics (if eBPF exporter is available)
  - job_name: 'ebpf-telemetry'
    scrape_interval: 15s
    metrics_path: '/metrics'
    static_configs:
      - targets:
          - 'node-a:9091'  # eBPF exporter port (if deployed)
          - 'node-b:9091'
          - 'node-c:9091'
        labels:
          component: 'ebpf'
          mesh_cluster: 'primary'

# Recording rules for aggregated metrics
rule_files:
  - 'recording-rules.yml'
  - 'alerting-rules.yml'
