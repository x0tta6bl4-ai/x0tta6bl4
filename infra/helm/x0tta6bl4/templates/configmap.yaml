apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "x0tta6bl4.fullname" . }}-config
  labels:
    {{- include "x0tta6bl4.labels" . | nindent 4 }}
data:
  config.yaml: |
    # x0tta6bl4 Mesh Configuration
    # Generated by Helm
    
    mesh:
      port: {{ .Values.mesh.config.meshPort }}
      apiPort: {{ .Values.mesh.config.apiPort }}
      metricsPort: {{ .Values.mesh.config.metricsPort }}
    
    # Zero Trust Security Configuration
    zeroTrust:
      enabled: {{ .Values.zeroTrust.enabled }}
      
      # ZKP Authentication (Schnorr/Pedersen)
      zkp:
        enabled: {{ .Values.zeroTrust.zkp.enabled }}
        algorithm: {{ .Values.zeroTrust.zkp.algorithm }}
        challengeTimeoutSeconds: {{ .Values.zeroTrust.zkp.challengeTimeout }}
      
      # Post-Quantum Cryptography
      postQuantum:
        enabled: {{ .Values.zeroTrust.postQuantum.enabled }}
        algorithm: {{ .Values.zeroTrust.postQuantum.algorithm }}
        keyRotationDays: {{ .Values.zeroTrust.postQuantum.keyRotationDays }}
      
      # Device Attestation
      deviceAttestation:
        enabled: {{ .Values.zeroTrust.deviceAttestation.enabled }}
        privacyPreserving: {{ .Values.zeroTrust.deviceAttestation.privacyPreserving }}
        tpmRequired: {{ .Values.zeroTrust.deviceAttestation.tpmRequired }}
      
      # Decentralized Identity (DIDs)
      did:
        enabled: {{ .Values.zeroTrust.did.enabled }}
        method: {{ .Values.zeroTrust.did.method }}
        credentialExpireDays: {{ .Values.zeroTrust.did.credentialExpireDays }}
      
      # Policy Engine (ABAC)
      policyEngine:
        enabled: {{ .Values.zeroTrust.policyEngine.enabled }}
        defaultEffect: {{ .Values.zeroTrust.policyEngine.defaultEffect }}
        cacheEnabled: {{ .Values.zeroTrust.policyEngine.cacheEnabled }}
        cacheTTL: {{ .Values.zeroTrust.policyEngine.cacheTTL }}
      
      # Continuous Verification
      continuousVerification:
        enabled: {{ .Values.zeroTrust.continuousVerification.enabled }}
        baseIntervalSeconds: {{ .Values.zeroTrust.continuousVerification.baseIntervalSeconds }}
        maxIntervalSeconds: {{ .Values.zeroTrust.continuousVerification.maxIntervalSeconds }}
        riskThreshold: {{ .Values.zeroTrust.continuousVerification.riskThreshold }}
      
      # Auto-Isolation
      autoIsolation:
        enabled: {{ .Values.zeroTrust.autoIsolation.enabled }}
        circuitBreakerThreshold: {{ .Values.zeroTrust.autoIsolation.circuitBreakerThreshold }}
        recoveryTimeoutSeconds: {{ .Values.zeroTrust.autoIsolation.recoveryTimeoutSeconds }}
      
      # Threat Intelligence
      threatIntelligence:
        enabled: {{ .Values.zeroTrust.threatIntelligence.enabled }}
        bloomFilterSize: {{ .Values.zeroTrust.threatIntelligence.bloomFilterSize }}
        reputationThreshold: {{ .Values.zeroTrust.threatIntelligence.reputationThreshold }}
        shareIndicators: {{ .Values.zeroTrust.threatIntelligence.shareIndicators }}
    
    # SPIFFE/SPIRE
    {{- if .Values.spiffe.enabled }}
    spiffe:
      enabled: true
      trustDomain: {{ include "x0tta6bl4.trustDomain" . }}
      endpointSocket: unix:///run/spire/sockets/agent.sock
    {{- end }}
    
    # Obfuscation / Anti-Censorship
    obfuscation:
      enabled: {{ .Values.obfuscation.enabled }}
      defaultTransport: {{ .Values.obfuscation.defaultTransport }}
      faketls:
        enabled: {{ .Values.obfuscation.faketls.enabled }}
        sni: {{ .Values.obfuscation.faketls.sni }}
      shadowsocks:
        enabled: {{ .Values.obfuscation.shadowsocks.enabled }}
        cipher: {{ .Values.obfuscation.shadowsocks.cipher }}
      domainFronting:
        enabled: {{ .Values.obfuscation.domainFronting.enabled }}
    
    # Networking
    networking:
      batmanAdv:
        enabled: {{ .Values.networking.batmanAdv.enabled }}
        interface: {{ .Values.networking.batmanAdv.interface }}
        hopPenalty: {{ .Values.networking.batmanAdv.hopPenalty }}
    
    # DAO Governance
    {{- if .Values.dao.enabled }}
    dao:
      enabled: true
      quorumPercent: {{ .Values.dao.quorumPercent }}
      votingPeriodHours: {{ .Values.dao.votingPeriodHours }}
      proposalThreshold: {{ .Values.dao.proposalThreshold }}
    {{- end }}
