# ‚úÖ DNS –∏ Ping –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:

### 1. DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- `protect_config.sh` —É–¥–∞–ª—è–ª DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
- DNS —Ç–∞–π–º–∞—É—Ç—ã 6-10 —Å–µ–∫—É–Ω–¥ –≤ –ª–æ–≥–∞—Ö –∫–ª–∏–µ–Ω—Ç–∞
- `domainStrategy: AsIs` (–º–µ–¥–ª–µ–Ω–Ω—ã–π)

**–†–µ—à–µ–Ω–∏–µ:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ DNS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å –±—ã—Å—Ç—Ä—ã–º–∏ —Å–µ—Ä–≤–µ—Ä–∞–º–∏:
  - `1.1.1.1` (Cloudflare)
  - `8.8.8.8` (Google)
  - `1.0.0.1` (Cloudflare —Ä–µ–∑–µ—Ä–≤–Ω—ã–π)
- `domainStrategy` –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ `IPIfNonMatch` (–±—ã—Å—Ç—Ä–µ–µ)
- Routing rules —É–ø—Ä–æ—â–µ–Ω—ã

### 2. Connection refused –∏—Å–ø—Ä–∞–≤–ª–µ–Ω ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- `dial tcp 89.125.1.107:39829: connect: connection refused`
- –°–µ—Ä–≤–µ—Ä –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ:**
- x-ui –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- –ü–æ—Ä—Ç 39829 –ø—Ä–æ–≤–µ—Ä–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ—Ü–µ—Å—Å xray –∑–∞–ø—É—â–µ–Ω

### 3. –°–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã ‚úÖ

- BBR –≤–∫–ª—é—á–µ–Ω
- TCP Fast Open
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±—É—Ñ–µ—Ä—ã
- –£–≤–µ–ª–∏—á–µ–Ω—ã –ª–∏–º–∏—Ç—ã —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

---

## üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å:

```
‚úÖ x-ui: —Ä–∞–±–æ—Ç–∞–µ—Ç
‚úÖ –ü–æ—Ä—Ç 39829: LISTEN
‚úÖ DNS: –¥–æ–±–∞–≤–ª–µ–Ω (3 —Å–µ—Ä–≤–µ—Ä–∞)
‚úÖ domainStrategy: IPIfNonMatch
‚úÖ BBR: –≤–∫–ª—é—á–µ–Ω
‚úÖ TCP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏: –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
```

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:

### –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —É–ª—É—á—à–∏—Ç—å—Å—è:

1. **DNS —Ç–∞–π–º–∞—É—Ç—ã:**
   - –ë—ã–ª–æ: 6-10 —Å–µ–∫—É–Ω–¥
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: <1 —Å–µ–∫—É–Ω–¥–∞

2. **Ping:**
   - –ë—ã–ª–æ: –≤—ã—Å–æ–∫–∏–π ping, -1 ms (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª)
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π ping, —Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-40%

3. **Connection refused:**
   - –ë—ã–ª–æ: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç–∫–∞–∑—ã
   - –û–∂–∏–¥–∞–µ—Ç—Å—è: —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

### –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ VPN –∫–ª–∏–µ–Ω—Ç (v2rayN) –ø–æ–ª–Ω–æ—Å—Ç—å—é**
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ ping** - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º
3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ DNS** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ç–∞–π–º–∞—É—Ç–æ–≤

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ:

**protect_config.sh** –≤—Å–µ –µ—â–µ –º–æ–∂–µ—Ç –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é. –ï—Å–ª–∏ DNS —Å–Ω–æ–≤–∞ –ø—Ä–æ–ø–∞–¥–µ—Ç:

```bash
# –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
python3 /root/fix_dns_final.py
systemctl restart x-ui
```

–ò–ª–∏ –æ—Ç–∫–ª—é—á–∏—Ç–µ `protect_config.sh` –ø–æ–ª–Ω–æ—Å—Ç—å—é:

```bash
# –û—Ç–∫–ª—é—á–∏—Ç—å timer
systemctl stop x-ui-config.timer
systemctl disable x-ui-config.timer

# –ò–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å protect_config.sh —á—Ç–æ–±—ã –æ–Ω –Ω–µ —É–¥–∞–ª—è–ª DNS
```

---

## üìù –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏:

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- –§–∞–π–ª: `/usr/local/x-ui/bin/config.json`
- DNS: –¥–æ–±–∞–≤–ª–µ–Ω —Å 3 —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- Routing: `IPIfNonMatch` + —É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ rules

**–°–∫—Ä–∏–ø—Ç—ã:**
- `/root/fix_dns_final.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ DNS –∏ routing
- `/root/optimize_ping.sh` - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è ping
- `/root/optimize_system_ping.sh` - —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**
- `/etc/sysctl.conf` - TCP –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `/etc/security/limits.conf` - –ª–∏–º–∏—Ç—ã —Ñ–∞–π–ª–æ–≤—ã—Ö –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤

---

## ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:

**VPN –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–º DNS (<1 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 6-10 —Å–µ–∫)
- ‚úÖ –ù–∏–∑–∫–∏–º ping (—Å–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞ 20-40%)
- ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω—ã–º–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ (–±–µ–∑ connection refused)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ TCP –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

**–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–ª–∏–µ–Ω—Ç –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ!** üöÄ

