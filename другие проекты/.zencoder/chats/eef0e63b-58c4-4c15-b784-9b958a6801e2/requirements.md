# Product Requirements Document (PRD)
## BazisLite-Web: Трансформация в профессиональную CAD систему

**Дата создания:** 18 января 2026  
**Версия:** 1.0  
**Статус:** ✅ ОДОБРЕНО

---

## 1. ОБЗОР

### 1.1 Цель
Трансформировать BazisLite-Web (текущий конфигуратор мебели) в **профессиональную CAD систему** с полным набором инженерных инструментов, сопоставимой с Fusion 360 по функциональности (в миниатюре).

### 1.2 Текущее состояние
- React 19 приложение с 3D визуализацией (Three.js + Babylon.js)
- Базовый конфигуратор шкафов (CabinetGenerator)
- Интеграция с Google Gemini API
- Управление проектами через Zustand
- Нет встроенных CAD инструментов: solver, BOM, DFM, оптимизация, FEA

### 1.3 Целевое состояние
- ✅ Constraint Solver для позиционирования компонентов
- ✅ Bill of Materials с иерархией и расчётами
- ✅ DFM Validator (15+ правил производимости)
- ✅ Параметрическая оптимизация (4 стратегии)
- ✅ CAD Export (STL, DXF, STEP, JSON)
- ✅ CAD Import для внешних моделей
- ✅ FEA интеграция (статический анализ, модальный)
- ✅ Полное тестовое покрытие (300+ тестов)

---

## 2. ОСНОВНЫЕ ТРЕБОВАНИЯ

### 2.1 Функциональные требования (по фазам)

#### Фаза 1: Архитектура (2 недели)
**Результат:** Фундамент для всех остальных фаз

**Требования:**
- [ ] Создать 100+ TypeScript интерфейсов в `types/CADTypes.ts`
- [ ] Определить структуру 9 сервис-модулей (скеллеты)
- [ ] Создать 5 новых React компонентов UI
- [ ] Интегрировать типы с существующей CabinetGenerator
- [ ] Написать 50+ unit тестов
- [ ] Все должно компилироваться без ошибок

**Типы для разработки:**
- 3D: Point3D, Vector3D, Transform, TransformMatrix, EulerAngles, BoundingBox
- Материалы: Material, TextureType, EdgeThickness
- Компоненты: Component, Assembly, AnchorPoint, Constraint
- BOM: BOMItem, BOMHierarchy, BOMExport
- DFM: DFMRule, DFMReport, ManufacturabilityScore
- Оптимизация: OptimizationStrategy, OptimizationResult
- Экспорт: CADFormat, ExportConfig, ImportConfig
- FEA: FEAAnalysis, SimulationResult, MeshData
- Иерархия: HierarchyNode, ComponentPath

#### Фаза 2: Constraint Solver (2 недели)
**Результат:** Автоматическое позиционирование компонентов

**Требования:**
- [ ] Реализовать Newton-Raphson solver для системы уравнений
- [ ] Поддержка 6 типов ограничений: совпадение, параллель, перпендикуляр, расстояние, угол, фиксация
- [ ] Сходимость < 500 мс на 50 компонентах
- [ ] 40+ unit тестов
- [ ] Интеграция с CabinetGenerator

**Граничные условия:**
- Максимум 100 компонентов в сборке
- Точность 0.1 мм
- Зависимости: numeric.js для матричных операций

#### Фаза 3: Bill of Materials (2 недели)
**Результат:** Полная BOM с экспортом

**Требования:**
- [ ] Расчёт массы, объёма, стоимости каждого элемента
- [ ] Иерархическая структура (сборка → подсборка → деталь)
- [ ] Экспорт в CSV, JSON, PDF
- [ ] React компонент HierarchyTree для навигации
- [ ] React компонент BOMViewer для визуализации
- [ ] Поддержка фильтрации и сортировки
- [ ] 35+ unit тестов

#### Фаза 4: DFM Validator (2 недели)
**Результат:** Проверка производимости

**Требования:**
- [ ] Реализовать 15+ правил DFM:
  - Минимальная толщина (4 мм для LDSP)
  - Радиусы скругления (≥ 1 мм)
  - Отношение сторон (максимум 80:1)
  - Расстояния от края (≥ 5 мм)
  - Минимальный размер отверстия (≥ 3 мм)
  - Толщина стенок (≥ 1.5 мм)
  - Зазоры для сборки (≥ 0.5 мм)
  - И т.д.
- [ ] Генерировать Manufacturability Score (0-100%)
- [ ] React компонент DFMReport для визуализации нарушений
- [ ] 40+ unit тестов

#### Фаза 5: Параметрическая оптимизация (3 недели)
**Результат:** Автоматическая оптимизация конструкции

**Требования:**
- [ ] 4 стратегии оптимизации:
  1. Cost минимизация (целевая экономия 10-20%)
  2. Weight минимизация
  3. Strength максимизация
  4. Balance (компромисс между Cost и Strength)
- [ ] Использовать Genetic Algorithm (можно заменить на PSO)
- [ ] Поддержка параметрических переменных (толщина, материал, размеры)
- [ ] React компонент OptimizationResults
- [ ] Сохранение истории оптимизаций
- [ ] 50+ unit тестов

#### Фаза 6: CAD Export/Import (2 недели)
**Результат:** Интеграция с внешними CAD системами

**Требования:**
- [ ] **STL экспорт** для 3D печати
- [ ] **DXF экспорт** для AutoCAD (2D чертежи)
- [ ] **STEP экспорт** (ISO 10303-21, профессиональный стандарт)
- [ ] **JSON экспорт** для веб-визуализации
- [ ] **JSON импорт** от других инструментов
- [ ] Сохранение метаданных (материалы, допуски, параметры)
- [ ] 30+ unit тестов
- [ ] Зависимость: three-stl-loader, xml2js для STEP

#### Фаза 7: FEA интеграция (3 недели)
**Результат:** Конечно-элементный анализ прочности

**Требования:**
- [ ] **Статический анализ:**
  - Расчёт напряжений и деформаций
  - Coefficient of Safety (CoS) ≥ 1.5 для мебели
  - Время расчёта < 5 сек на 1000 узлов
- [ ] **Модальный анализ:**
  - Определение собственных частот
  - Формы колебаний (первые 5)
- [ ] Генерация сетки (mesh) автоматически
- [ ] React компонент FEAPanel для визуализации результатов
- [ ] Цветовые карты напряжений и деформаций
- [ ] Интеграция с Web Workers для параллельных вычислений
- [ ] 40+ unit тестов
- [ ] Возможное использование WebAssembly для критических путей

#### Фаза 8: Тестирование & QA (2 недели)
**Результат:** Production readiness

**Требования:**
- [ ] 150+ интеграционных E2E тестов
- [ ] Полное покрытие 300+ unit тестов
- [ ] Performance отчёты (memory, CPU, render time)
- [ ] Полная API документация (JSDoc)
- [ ] Production checklist
- [ ] Performance budget:
  - Solver: < 500 мс на 50 компонентах
  - FEA: < 5 сек на 1000 узлов
  - Export: < 2 сек для STL
  - Import: < 1 сек для JSON

### 2.2 Нефункциональные требования

#### Производительность
- Solver сходится < 500 мс
- FEA расчёты < 5 сек
- Экспорт < 2 сек
- UI не должна зависать (использовать Web Workers)
- Memory: < 200 МБ для типовой сборки

#### Масштабируемость
- Поддержка до 100 компонентов в сборке
- До 1000 узлов в FEA сетке
- До 10,000 строк в BOM

#### Надёжность
- Test coverage > 85%
- Graceful error handling
- Fallback для всех критических операций
- Логирование всех ошибок

#### Совместимость
- TypeScript strict mode
- React 19.2.3
- Es2022 syntax
- Поддержка Chrome/Firefox/Safari (последние 2 версии)

---

## 3. АРХИТЕКТУРНЫЕ РЕШЕНИЯ

### 3.1 Язык и фреймворк
- **Язык:** TypeScript (strict mode)
- **UI:** React 19.2.3 + React DOM
- **State Management:** Zustand 5.0.10
- **3D Visualization:** Three.js + Babylon.js 6.32.1
- **Build:** Vite 6.2.0
- **Тестирование:** Jest 30.2.0 + ts-jest

### 3.2 Новые зависимости
- `numeric` — матричные операции, linear algebra
- `xml2js` — парсинг STEP/XML форматов
- `three-stl-loader` — загрузка STL моделей
- Потенциально: `napi-rs/numeric-rs` для WebAssembly оптимизации

### 3.3 Структура модулей

```
services/
├── ConstraintSolver.ts       (Фаза 2) — Newton-Raphson метод
├── BillOfMaterials.ts        (Фаза 3) — Иерархия и расчёты
├── HierarchyManager.ts       (Фаза 3) — Управление деревом
├── DFMValidator.ts           (Фаза 4) — 15+ правил
├── CabinetOptimizer.ts       (Фаза 5) — GA / PSO алгоритм
├── CADExporter.ts            (Фаза 6) — STL, DXF, STEP, JSON
├── CADImporter.ts            (Фаза 6) — Импорт внешних моделей
├── FEAIntegration.ts         (Фаза 7) — Solver + Mesh Generation
├── PerformanceMonitor.ts     (Фаза 8) — Метрики и логирование
└── __tests__/               (150+ тестов)

components/
├── BOMViewer.tsx            (Фаза 3)
├── HierarchyTree.tsx        (Фаза 3)
├── DFMReport.tsx            (Фаза 4)
├── OptimizationResults.tsx  (Фаза 5)
└── FEAPanel.tsx             (Фаза 7)
```

### 3.4 Интеграция с существующим кодом
- Расширение CabinetGenerator без переписи
- Использование существующих типов из types.ts
- Сохранение паттернов Zustand (projectStore)
- Сохранение UI patterns (React hooks, components)
- Сохранение 3D pipeline (Three.js основной engine)

---

## 4. ПОЛЬЗОВАТЕЛЬСКИЕ ИСТОРИИ

### 4.1 Дизайнер мебели
> Я хочу автоматически позиционировать компоненты без ручного расчёта, чтобы ускорить процесс проектирования

**Acceptance Criteria:**
- Ограничения применяются мгновенно
- Solver показывает статус и ошибки
- Результаты можно отменить (Undo)

### 4.2 Производитель
> Я хочу получить полный BOM с расчётом стоимости и проверить производимость, чтобы снизить брак

**Acceptance Criteria:**
- BOM экспортируется в CSV для ERP
- DFM отчёт показывает все нарушения
- Есть рекомендации по исправлению

### 4.3 Инженер
> Я хочу провести анализ прочности (FEA) и оптимизировать конструкцию по затратам, чтобы улучшить качество и прибыль

**Acceptance Criteria:**
- FEA показывает напряжения и deformations
- Safety Factor ≥ 1.5 для мебели
- Оптимизация даёт 10-20% экономию

### 4.4 Интегратор
> Я хочу экспортировать в STL/DXF/STEP, чтобы интегрировать с производственной цепочкой

**Acceptance Criteria:**
- Все форматы сохраняют метаданные
- Импорт работает с внешними моделями
- Зависимости решаются корректно

---

## 5. КРИТЕРИИ ПРИЁМА

### 5.1 По фазам
Каждая фаза должна:
- ✅ Иметь 100% покрытие unit тестами (для новых модулей > 85%)
- ✅ Проходить `npm run lint` и `npm run typecheck` без ошибок
- ✅ Иметь полную JSDoc документацию
- ✅ Интегрироваться с App.tsx (новая кнопка или меню)
- ✅ Пройти code review
- ✅ Быть развёрнутой на dev/staging окружении

### 5.2 Финальные критерии (Фаза 8)
- ✅ 300+ unit тестов, все зелёные
- ✅ 150+ E2E тестов
- ✅ Performance benchmarks записаны
- ✅ Полная документация (README, API docs, user guides)
- ✅ Готовность к production (security, error handling, logging)

---

## 6. РИСКИ И СМЯГЧЕНИЕ

| Риск | Вероятность | Смягчение |
|------|-------------|----------|
| Solver не сходится | 35% | Использовать numeric.js, не писать с нуля |
| FEA требует много CPU | 50% | Web Workers + WebAssembly для критических путей |
| Scope creep | 55% | Strict feature freeze, все v2.0 находятся в backlog |
| Team не готова | 25% | 2 дня training + pair programming на Фазе 1 |
| Performance проблемы | 40% | Performance budget на каждую фазу, профилирование рано |

---

## 7. УСПЕХ И МЕТРИКИ

### 7.1 Ключевые показатели

| Метрика | Целевое значение | Как мерить |
|---------|-----------------|-----------|
| Test coverage | > 85% | `npm run test:coverage` |
| Performance: Solver | < 500 мс | Benchmark тесты |
| Performance: FEA | < 5 сек | Benchmark тесты |
| Type safety | 100% strict | TypeScript без `any` |
| Documentation | 100% JSDoc | Проверка в CI |
| Компиляция | 0 ошибок | `npm run typecheck` |

### 7.2 Определение "готово к delivery"
Фаза считается готовой когда:
1. Все 3 pull request reviews одобрены
2. Все тесты проходят (green CI)
3. Performance benchmarks соответствуют целям
4. Documentation complete
5. No blockers в backlog

---

## 8. TIMELINE И РЕСУРСЫ

### 8.1 План по неделям
```
Нед 1-2:  Фаза 1 - Архитектура (1-2 разработчика)
Нед 3-4:  Фаза 2 - Solver (2 разработчика)
Нед 5-6:  Фаза 3 - BOM (1-2 разработчика)
Нед 7-8:  Фаза 4 - DFM (1 разработчик)
Нед 9-11: Фаза 5 - Оптимизация (2-3 разработчика, параллельно 6)
Нед 12-13: Фаза 6 - Export/Import (2 разработчика, параллельно 5)
Нед 14-16: Фаза 7 - FEA (2-3 разработчика)
Нед 17-18: Фаза 8 - Тестирование (2-3 разработчика)
```

### 8.2 Расресурсы
- 2-3 разработчика
- 1550 часов (18 недель × 40-45 часов/неделя)
- Code review: 1 person, 2 часа в день

---

## 9. SUCCESS CRITERIA

✅ **Success Definition:** BazisLite-Web становится **профессиональной CAD системой** с:
- Автоматическим позиционированием
- Полной BOM с расчётами
- Проверкой производимости
- Анализом прочности
- Экспортом в стандартные форматы
- > 85% test coverage
- Production-ready качеством

**Business Impact:**
- Конкурентоспособное предложение против Fusion 360 Lite
- Возможность B2B продаж дизайнерам и производителям
- Готовность к enterprise интеграции (ERP)
- Tech leadership в мебельной индустрии
