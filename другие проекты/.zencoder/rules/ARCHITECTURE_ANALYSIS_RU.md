# –£–≥–ª—É–±–ª–µ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã BazisLite-Web

## 1. CabinetGenerator ‚Äî –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —à–∫–∞—Ñ–æ–≤ (71 –ö–ë)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è –ø—Ä–æ—Ü–µ–¥—É—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –º–µ–±–µ–ª–∏. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —à–∫–∞—Ñ–∞ (—à–∏—Ä–∏–Ω–∞, –≤—ã—Å–æ—Ç–∞, –≥–ª—É–±–∏–Ω–∞, —Ç–∏–ø –¥–≤–µ—Ä–µ–π) –≤ –Ω–∞–±–æ—Ä 3D-–ø–∞–Ω–µ–ª–µ–π —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π, –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏, —Ñ—É—Ä–Ω–∏—Ç—É—Ä–æ–π –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è–º–∏.

### –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

**1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (STD)**
```typescript
TH_BODY: 16      // –¢–æ–ª—â–∏–Ω–∞ –∫–æ—Ä–ø—É—Å–∞ –≤ –º–º
TH_BACK: 4       // –¢–æ–ª—â–∏–Ω–∞ –∑–∞–¥–Ω–µ–π —Å—Ç–µ–Ω–∫–∏
RAIL_GAP: 13     // –ó–∞–∑–æ—Ä –¥–ª—è –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏—Ö
COUPE_DEPTH: 80  // –ì–ª—É–±–∏–Ω–∞ –∫—É–ø–µ (—Ä–∞–∑–¥–≤–∏–∂–Ω—ã–µ –¥–≤–µ—Ä–∏)
```

**2. –ü–∞—Ä–∞–º–µ—Ç–µ—Ä–Ω—ã–π –∫–µ—à (ParameterCache)**
- –£–º–µ–Ω—å—à–∞–µ—Ç –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –Ω–∞ 55%
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–µ—Ç hit/miss rate –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ö–µ—à–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –∫–ª—é—á–æ–º `internal_${doorType}_${backType}_${depth}`
- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–µ—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ config, –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –ø—Ä–∏ –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞

**3. –û—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã**

| –ú–µ—Ç–æ–¥ | –§—É–Ω–∫—Ü–∏—è | –°–ª–æ–∂–Ω–æ—Å—Ç—å |
|-------|---------|----------|
| `generate()` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–∞–Ω–µ–ª–∏ –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π | O(n) –≥–¥–µ n ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–¥–µ–ª–æ–≤ |
| `generateWithConstraints()` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç + —Ä–µ—à–∞–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–µ—Ä–µ–∑ Newton-Raphson | O(n * iterations) |
| `generateAssembly()` | –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Panel[] ‚Üí Assembly (–¥–ª—è –§–ê–ó–´ 2) | O(n*m) –≥–¥–µ m ‚Äî –≤–µ—Ä—à–∏–Ω—ã –ø–∞–Ω–µ–ª–∏ |
| `calculateShelfStiffness()` | –†–∞—Å—á–µ—Ç –ø—Ä–æ–≤–∏—Å–∞–Ω–∏—è –ø–æ–ª–æ–∫ –ø–æ —Ç–æ—á–Ω–æ–π —Ñ–æ—Ä–º—É–ª–µ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏—è –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ | O(1) |
| `generateHardware()` | –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —Ñ—É—Ä–Ω–∏—Ç—É—Ä—É (–ø–µ—Ç–ª–∏, –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ, –∫—Ä–µ–ø–µ–∂–∏) | O(1) |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏

**calculateShelfStiffness** (–†–∞—Å—á–µ—Ç –ø—Ä–æ–≥–∏–±–∞ –ø–æ–ª–æ–∫)
```
Œ¥ = (5 * w * L‚Å¥) / (384 * E * I)
–≥–¥–µ:
- w = –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –µ–¥–∏–Ω–∏—Ü—É –¥–ª–∏–Ω—ã (–ù/–º–º)
- L = –ø—Ä–æ–ª—ë—Ç (–º–º)  
- E = –º–æ–¥—É–ª—å —É–ø—Ä—É–≥–æ—Å—Ç–∏ (N/mm¬≤)
- I = –º–æ–º–µ–Ω—Ç –∏–Ω–µ—Ä—Ü–∏–∏ = (depth * thickness¬≥) / 12
```
–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω—É–∂–Ω—ã –ª–∏ —É—Å–∏–ª–∏—Ç–µ–ª–∏ –∏ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –æ–ø–æ—Ä–∞–º–∏.

**generatePanels** (–û—Å–Ω–æ–≤–Ω–æ–π –∞–ª–≥–æ—Ä–∏—Ç–º)
1. –°–æ–∑–¥–∞–µ—Ç –±–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ (–ª–µ–≤–∞—è/–ø—Ä–∞–≤–∞—è)
2. –°–æ–∑–¥–∞–µ—Ç –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø–∞–Ω–µ–ª–∏ (–∫—Ä—ã—à–∞, –¥–Ω–æ)
3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –ø–æ–ª–∫–∏ —Å –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ–º
4. –°–æ–∑–¥–∞–µ—Ç —Ñ–∞—Å–∞–¥—ã (–¥–≤–µ—Ä–∏) –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ (—Ä–∞—Å–ø–∞—à–Ω—ã–µ, –∫—É–ø–µ, –±–µ–∑ –¥–≤–µ—Ä–µ–π)
5. –°–æ–∑–¥–∞–µ—Ç/–≤—ã—á–∏—Å–ª—è–µ—Ç –ø–∞–∑—ã –¥–ª—è –∑–∞–¥–Ω–µ–π —Å—Ç–µ–Ω–∫–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ü–∞—Ä–∞–º–µ—Ç–µ—Ä–Ω—ã–π –∫–µ—à –Ω–µ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è**
```typescript
// –í –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ ‚Äî –∫–µ—à —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑
private paramCache = new ParameterCache();

// –ù–æ –µ—Å–ª–∏ –≤—ã–∑–≤–∞—Ç—å generate() –¥–≤–∞–∂–¥—ã —Å —Ä–∞–∑–Ω—ã–º–∏ config ‚Äî –±—É–¥–µ—Ç –±–∞–≥
const gen1 = new CabinetGenerator(config1, ...);
gen1.generate(); // –ö–µ—à –¥–ª—è config1
// –ï—Å–ª–∏ –≥–¥–µ-—Ç–æ –≤–Ω—É—Ç—Ä–∏ config –∏–∑–º–µ–Ω–∏–ª—Å—è, —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±—É–¥–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π
```

**2. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –ñ–µ—Å—Ç–∫–∞—è —Å–≤—è–∑—å —Å ConstraintSolver**
```typescript
const solver = new ConstraintSolver();
const solverResult = solver.solve(assembly, initialPositions);
```
–°–ª–æ–∂–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å, –Ω–µ–ª—å–∑—è –ø–æ–¥–º–µ–Ω–∏—Ç—å solver –Ω–∞ mock –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

**3. ‚ùå –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
–ú–µ—Ç–æ–¥—ã –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- –Ø–≤–ª—è–µ—Ç—Å—è –ª–∏ config.width/height/depth –≤ –¥–æ–ø—É—Å—Ç–∏–º–æ–º –¥–∏–∞–ø–∞–∑–æ–Ω–µ?
- –°–æ–≤–º–µ—Å—Ç–∏–º—ã –ª–∏ doorType –∏ doorCount?
- –ï—Å—Ç—å –ª–∏ –Ω—É–∂–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª –≤ materialLibrary?

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 1: –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞**
```typescript
constructor(config: CabinetConfig, ...) {
  this.config = config;
  this.invalidateCache();  // –Ø–≤–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
}

private invalidateCache() {
  if (configChanged) this.paramCache.invalidate();
}
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 2: Dependency Injection –¥–ª—è Solver**
```typescript
constructor(
  config: CabinetConfig, 
  sections: Section[],
  materialLibrary: Material[],
  constraintSolver?: ConstraintSolver  // Optional DI
) {
  this.solver = constraintSolver || new ConstraintSolver();
}
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 3: –í—Ö–æ–¥–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è**
```typescript
validate(): ValidationResult {
  const errors: ValidationError[] = [];
  if (config.width < 200 || config.width > 5000) 
    errors.push(new ValidationError('width', '–í–Ω–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–≥–æ –¥–∏–∞–ø–∞–∑–æ–Ω–∞'));
  return { isValid: errors.length === 0, errors };
}
```

---

## 2. ConstraintSolver ‚Äî –†–µ—à–∞—Ç–µ–ª—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–†–µ—à–∞–µ—Ç —Å–∏—Å—Ç–µ–º—É **–Ω–µ–ª–∏–Ω–µ–π–Ω—ã—Ö —É—Ä–∞–≤–Ω–µ–Ω–∏–π** –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –º–µ—Ç–æ–¥–æ–º **Newton-Raphson** –¥–ª—è –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–±–æ—Ä–∫–∏ –≤ 3D –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ.

### –ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ

**–ê–ª–≥–æ—Ä–∏—Ç–º Newton-Raphson**
```
–ò—Ç–µ—Ä–∞—Ü–∏—è i:
1. –í—ã—á–∏—Å–ª–∏—Ç—å residual –≤–µ–∫—Ç–æ—Ä f(x) –¥–ª—è –≤—Å–µ—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
2. –í—ã—á–∏—Å–ª–∏—Ç—å Jacobian –º–∞—Ç—Ä–∏—Ü—É J (—á–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ)
3. –†–µ—à–∏—Ç—å —Å–∏—Å—Ç–µ–º—É: J * Œîx = -f(x) –º–µ—Ç–æ–¥–æ–º LU —Ä–∞–∑–ª–æ–∂–µ–Ω–∏—è
4. –û–±–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏–∏: x_{i+1} = x_i + Œîx
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–æ–¥–∏–º–æ—Å—Ç—å: ||Œîx|| < tolerance
```

**–ß–∏—Å–ª–µ–Ω–Ω–æ–µ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏–µ Jacobian**
```typescript
for each constraint c:
  for each component comp:
    jacobian[c][comp] = (f_c(pos + h*delta) - f_c(pos - h*delta)) / (2*h)
    // h = 0.001 (stepSize)
```

### –¢–∏–ø—ã –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

| –¢–∏–ø | –û–ø–∏—Å–∞–Ω–∏–µ | –£—Ä–∞–≤–Ω–µ–Ω–∏–µ |
|-----|---------|-----------|
| FIXED | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω –≤ –ø–æ–∑–∏—Ü–∏–∏ | x_i = x_fixed, y_i = y_fixed, z_i = z_fixed |
| DISTANCE | –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏ | \|\|pos_1 - pos_2\|\| = distance |
| PARALLEL | –û—Å–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã | axis_1 √ó axis_2 = 0 |
| PERPENDICULAR | –û—Å–∏ –ø–µ—Ä–ø–µ–Ω–¥–∏–∫—É–ª—è—Ä–Ω—ã | axis_1 ¬∑ axis_2 = 0 |
| COLLINEAR | –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –æ–¥–Ω–æ–π –ª–∏–Ω–∏–∏ | (pos_2 - pos_1) √ó direction = 0 |
| CONCENTRIC | –¶–µ–Ω—Ç—Ä—ã —Å–æ–≤–ø–∞–¥–∞—é—Ç | pos_1 = pos_2 |
| SYMMETRIC | –°–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã–µ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –ø–ª–æ—Å–∫–æ—Å—Ç–∏ | ... |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```typescript
tolerance: 0.001           // –ü–æ—Ä–æ–≥ —Å—Ö–æ–¥–∏–º–æ—Å—Ç–∏ (–º–º)
maxIterations: 100         // –ú–∞–∫—Å–∏–º—É–º –∏—Ç–µ—Ä–∞—Ü–∏–π (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª)
stepSize: 0.001           // –®–∞–≥ —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è
```

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. ‚ùå NaN/Infinity –∑–∞—â–∏—Ç–∞ —Å–ª–∞–±–∞—è**
```typescript
// –ï—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ isFinite, –Ω–æ –Ω–µ –≤–µ–∑–¥–µ
let sumOfSquares = 0;
for (const r of residualVector) {
  if (isFinite(r)) {  // –ó–∞—â–∏—Ç–∞
    sumOfSquares += r * r;
  }
}
// –ù–æ –µ—Å–ª–∏ jacobian —Å–æ–¥–µ—Ä–∂–∏—Ç NaN, —Ä–µ—à–µ–Ω–∏–µ –±—É–¥–µ—Ç –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ
```

**2. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –º–∞—Ç—Ä–∏—Ü –Ω–∞ –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω–æ—Å—Ç—å**
```typescript
// LU —Ä–∞–∑–ª–æ–∂–µ–Ω–∏–µ –º–æ–∂–µ—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è –µ—Å–ª–∏ –º–∞—Ç—Ä–∏—Ü–∞ –≤—ã—Ä–æ–∂–¥–µ–Ω–Ω–∞
const deltaX = this.solveLU(jacobian, residualVector.map(r => -r));
if (!deltaX) {
  // –ú–æ–ª—á–∞ –≤—ã—Ö–æ–¥–∏—Ç –±–µ–∑ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø—Ä–∏—á–∏–Ω–µ
  break;
}
```

**3. ‚ùå –ù–µ—Ç –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ —à–∞–≥–∞**
–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π stepSize –¥–ª—è —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ –¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏—Ä–æ–≤–∞–Ω–∏—è ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –º–∞–ª—ã–º –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–æ–≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤.

**4. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–∏–Ω–∏—è –ø–æ–∏—Å–∫–∞ (line search)**
–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ x_{i+1} = x_i + Œîx –º–æ–∂–µ—Ç –Ω–µ —Å—Ö–æ–¥–∏—Ç—å—Å—è –µ—Å–ª–∏ —à–∞–≥ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 1: –†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –≤—ã—Ä–æ–∂–¥–µ–Ω–∏–∏ –º–∞—Ç—Ä–∏—Ü—ã**
```typescript
const jacobian = this.computeJacobianNumerical(...);
// –ï—Å–ª–∏ det(jacobian) –±–ª–∏–∑–æ–∫ –∫ 0, –¥–æ–±–∞–≤–∏—Ç—å —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—é
if (Math.abs(det(jacobian)) < 1e-10) {
  // –î–æ–±–∞–≤–∏—Ç—å –º–∞–ª—É—é –≤–µ–ª–∏—á–∏–Ω—É –Ω–∞ –¥–∏–∞–≥–æ–Ω–∞–ª—å (Tikhonov regularization)
  for (let i = 0; i < jacobian.length; i++) {
    jacobian[i][i] += 1e-6;
  }
}
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 2: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π stepSize**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–µ–ª–∏—á–∏–Ω—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const scale = Math.max(...assembly.components.map(c => 
  Math.hypot(c.position.x, c.position.y, c.position.z)
));
this.stepSize = Math.max(0.001, scale * 0.0001);
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 3: Line Search (Backtracking)**
```typescript
let alpha = 1.0;
while (alpha > 0.1) {
  const candidatePos = positions.map((p, i) => 
    p + alpha * deltaX[i]
  );
  if (residual_new < residual) break;
  alpha *= 0.5;  // Halving
}
```

---

## 3. geminiService ‚Äî Google Gemini –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Gemini 2.0 –¥–ª—è:
- ü§ñ **–ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π** (–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —è–∑—ã–∫ ‚Üí JSON –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
- üîç **–ê—É–¥–∏—Ç–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–π** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- üë®‚Äçüè´ **–≠–∫—Å–ø–µ—Ä—Ç–Ω—ã—Ö –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–π** (–≤–æ–ø—Ä–æ—Å—ã –æ –º–µ–±–µ–ª—å–Ω–æ–º –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ)
- ‚úèÔ∏è **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–∏–∑–∞–π–Ω–∞** (—É–ª—É—á—à–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

**3 —Ç–∏–ø–∞ system prompts**:

| Prompt | –†–æ–ª—å | –í—ã—Ö–æ–¥ |
|--------|------|-------|
| GENERATOR | Furniture Engineer | JSON config + sections |
| AUDITOR | Chief Technologist | –ú—è–≥–∫–∞—è –∏ –∂–µ—Å—Ç–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∏–∑–∏–∫–∏ |
| EXPERT | Mentor Carpenter | –¢–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–≤–µ—Ç—ã (–Ω–∞ —Ä—É—Å—Å–∫–æ–º) |

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–Ω–∞–Ω–∏—è (–≤ AUDITOR)

```typescript
SHELF_DEFLECTION: 16mm max L=700 (light) or 550 (heavy)
HINGES: <900mm (2), 900-1600mm (3), 1600-2000mm (4), >2000mm (5)
DRAWERS: Internal depth >= cabinet depth - 10mm minimum
EDGING: Floor contact parts must be edged (2mm visible, 0.4mm body)
RIGIDITY: Tall cabinets (>2000mm) need fixed horizons or stiffeners
GEOMETRY: Intersecting panels are physically impossible
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ Gemini

**–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫**:

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –°–∏–º–ø—Ç–æ–º—ã | –î–µ–π—Å—Ç–≤–∏–µ |
|-----------|----------|---------|
| SAFETY | "blocked", "safety", "policy" | ‚ùå –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å, –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å |
| CLIENT | 403, "api key", "region" | ‚ùå –ù–µ –ø–æ–≤—Ç–æ—Ä—è—Ç—å, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–ª—é—á/VPN |
| QUOTA | 429, "quota", "limit" | ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å exponential backoff |
| SERVER | 5xx | ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å exponential backoff |
| NETWORK | "fetch", "offline", "connection" | ‚úÖ –ü–æ–≤—Ç–æ—Ä–∏—Ç—å —Å exponential backoff |

**Exponential Backoff**:
```typescript
delay = INITIAL_DELAY * (EXPONENTIAL_BASE ^ attempt) + random(JITTER)
delay = min(delay, MAX_DELAY)
// 1s -> 2s -> 4s -> 8s -> ... -> 15s
```

### –û—á–∏—Å—Ç–∫–∞ JSON –æ—Ç–≤–µ—Ç–æ–≤

–§—É–Ω–∫—Ü–∏—è `cleanJsonResponse()` –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≥—Ä—è–∑–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã Gemini:
- –£–¥–∞–ª—è–µ—Ç Markdown –±–ª–æ–∫–∏ (```json ... ```)
- –£–¥–∞–ª—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (// –∏ /* */)
- –£–¥–∞–ª—è–µ—Ç –∑–∞–ø—è—Ç—ã–µ –ø–µ—Ä–µ–¥ –∑–∞–∫—Ä—ã–≤–∞—é—â–∏–º–∏ —Å–∫–æ–±–∫–∞–º–∏
- –≠–∫—Å—Ç—Ä–∞–≥–∏—Ä—É–µ—Ç JSON –æ–±—ä–µ–∫—Ç –∏–∑ —Ç–µ–∫—Å—Ç–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. ‚ùå –ù–µ—Ç —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∫–µ—à–∞**
```typescript
// –ö–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –≤ Gemini, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ
// –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ hash(prompt)
const cacheKey = hash(systemPrompt + userMessage);
if (this.cache.has(cacheKey)) return this.cache.get(cacheKey);
```

**2. ‚ùå –ù–µ—Ç timeout –¥–ª—è Gemini –∑–∞–ø—Ä–æ—Å–æ–≤**
```typescript
// –ï—Å–ª–∏ Gemini –∑–∞–≤–∏—Å–Ω–µ—Ç, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≤–∏—Å–Ω–µ—Ç
const timeout = 30000; // 30 —Å–µ–∫
Promise.race([
  this.client.generateContent(...),
  new Promise((_, reject) => 
    setTimeout(() => reject(new Error('Timeout')), timeout)
  )
])
```

**3. ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON –ø–µ—Ä–µ–¥ –ø–∞—Ä—Å–∏–Ω–≥–æ–º**
```typescript
// –ü–æ—Å–ª–µ cleanJsonResponse(), –≤—Å–µ –µ—â–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π JSON
try {
  const parsed = JSON.parse(clean);
  // –ù–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É config –∏ sections
  this.validateGeneratedConfig(parsed);
} catch (e) {
  // –ü–∞–¥–∞–µ—Ç —Å –∫—Ä–∏–ø–∏—á–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ–± –æ—à–∏–±–∫–µ
}
```

**4. ‚ùå –ù–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ (feedback) –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**
–ù–µ–ª—å–∑—è —Å–∫–∞–∑–∞—Ç—å Gemini "—ç—Ç–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ, –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞.

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 1: –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å LRU**
```typescript
import LRU from 'lru-cache';
private cache = new LRU<string, any>({ max: 100, maxAge: 3600000 });

const cacheKey = crypto.subtle.digest('SHA-256', prompt).then(h => 
  Array.from(new Uint8Array(h)).map(b => b.toString(16)).join('')
);
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 2: Timeout –æ–±—Ä–∞–±–æ—Ç–∫–∞**
```typescript
async generateWithTimeout(prompt: string, timeout = 30000) {
  return Promise.race([
    this.client.generateContent(prompt),
    new Promise((_, reject) => 
      setTimeout(() => reject(new Error('Request timeout')), timeout)
    )
  ]);
}
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 3: –°—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON**
```typescript
function validateGeneratedConfig(data: any): ValidationResult {
  const schema = {
    config: {
      name: 'string',
      width: { min: 200, max: 5000 },
      height: { min: 400, max: 3000 },
      depth: { min: 350, max: 700 },
      doorType: ['none', 'hinged', 'sliding', 'folding']
    },
    sections: 'array<Section>'
  };
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∏ —Ç–∏–ø—ã
}
```

**‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ 4: Context-aware prompting**
```typescript
// –°–æ—Ö—Ä–∞–Ω—è—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ
private conversationHistory: Array<{role, content}> = [];

async askWithHistory(userMessage: string) {
  this.conversationHistory.push({role: 'user', content: userMessage});
  const response = await this.generateContent({
    messages: this.conversationHistory
  });
  this.conversationHistory.push({role: 'assistant', content: response});
  return response;
}
```

---

## 4. hardwareUtils ‚Äî –£—Ç–∏–ª–∏—Ç—ã –∫—Ä–µ–ø–µ–∂–∞

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ—É—Ä–Ω–∏—Ç—É—Ä–æ–π: –ø–µ—Ç–ª–∏, –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–µ, –∫—Ä–µ–ø–µ–∂–∏, –ø–æ–ª–∫–æ–¥–µ—Ä–∂–∞—Ç–µ–ª–∏, —Ä—É—á–∫–∏ –∏ —Ç.–¥.

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

```typescript
screw: { diameter: ‚àÖ, minEdgeDistance: 10–º–º, edgeDist: 15–º–º }
minifix_cam: { diameter: ‚àÖ, minEdgeDistance: 15–º–º }
dowel: { diameter: ‚àÖ, minEdgeDistance: 10–º–º }
handle: { width: 120–º–º, minEdgeDistance: 40–º–º }
shelf_support: { diameter: ‚àÖ, minEdgeDistance: 10–º–º }
hinge_cup: { diameter: 35–º–º, minEdgeDistance: 50–º–º }
```

### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

1. **validateHardwarePosition** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–æ–∑–∏—Ü–∏–∏
2. **calculateOptimalPositions** ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è —Ä–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫—Ä–µ–ø–µ–∂–µ–π
3. **generateHardwareArray** ‚Äî –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Å—Å–∏–≤–∞ –∫—Ä–µ–ø–µ–∂–µ–π
4. **checkInterferences** ‚Äî –ø–æ–∏—Å–∫ –∫–æ–ª–ª–∏–∑–∏–π –º–µ–∂–¥—É –∫—Ä–µ–ø–µ–∂–∞–º–∏

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. ‚ùå –ñ–µ—Å—Ç–∫–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤–º–µ—Å—Ç–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏**
```typescript
// –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞—à–∏—Ç—ã –≤ HARDWARE_CONFIG
// –ù–µ–ª—å–∑—è –ª–µ–≥–∫–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã (Blum, Hettich, GTV)
```

**2. ‚ùå –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å –º–∞—Ç–µ—Ä–∏–∞–ª–æ–º**
–ù–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—â–∏–Ω–∞ –∏ —Å–≤–æ–π—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –≥–ª—É–±–∏–Ω—ã —Å–≤–µ—Ä–ª–µ–Ω–∏—è.

---

## 5. BillOfMaterials ‚Äî –°–º–µ—Ç–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–†–∞—Å—á–µ—Ç:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ (–∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–µ –º–µ—Ç—Ä—ã, –∫–∏–ª–æ–≥—Ä–∞–º–º—ã)
- –°—Ç–æ–∏–º–æ—Å—Ç–∏ (–º–∞—Ç–µ—Ä–∏–∞–ª + –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ)
- –í—Ä–µ–º–µ–Ω–∏ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞ (–Ω–æ—Ä–º—ã –ø–æ –æ–ø–µ—Ä–∞—Ü–∏—è–º)
- –ò–µ—Ä–∞—Ä—Ö–∏–∏ —Å–±–æ—Ä–∫–∏ (Assembly ‚Üí Components ‚Üí Materials)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ BOM

```typescript
BOMItem {
  id, componentId, componentName, type,
  material, quantity, volume, mass, cost, productionTime
}

BOMStats {
  totalItems, uniqueComponents, totalQuantity,
  totalMass, totalMaterialCost, manufacturingCost, totalCost
}
```

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è BOM

**‚úÖ –î–æ–±–∞–≤–∏—Ç—å Support –¥–ª—è –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö —Å–±–æ—Ä–æ–∫**
```typescript
interface BOMMaterial {
  materialId, materialName, quantity, totalVolume,
  totalMass, totalCost, productionTime,
  components: string[],
  hierarchy: BOMItem[]  // –í–ª–æ–∂–µ–Ω–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
}
```

---

## 6. InputValidator ‚Äî –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–æ–≤

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –≤—Ö–æ–¥–æ–≤ —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –æ–± –æ—à–∏–±–∫–∞—Ö.

### Constraint –≥—Ä–∞–Ω–∏—Ü—ã

```typescript
panel: {
  width: { min: 50, max: 5000 },
  height: { min: 50, max: 5000 },
  depth: { min: 4, max: 1000 }
}

cabinet: {
  width: { min: 200, max: 5000 },
  height: { min: 400, max: 3000 },
  depth: { min: 350, max: 700 }
}
```

### –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

```typescript
ValidationRule {
  type: 'string' | 'number' | 'boolean' | 'object',
  required: boolean,
  min, max: number,
  pattern: RegExp,
  custom: (value) => boolean | string,
  transform: (value) => unknown
}
```

---

## 7. DFMValidator ‚Äî Design for Manufacturing

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç–æ–ª—â–∏–Ω—ã —Å—Ç–µ–Ω–æ–∫
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ä–∞–¥–∏—É—Å—ã —Å–∫—Ä—É–≥–ª–µ–Ω–∏–π
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å—Ç–æ—Ä–æ–Ω
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ä—Å—Ç–∏–π
- –í–µ—Å –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

### DFM –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

```typescript
minWallThickness: 1.5–º–º (–¥–ª—è –î–°–ü)
minFilletRadius: 0.5–º–º
maxAspectRatio: 10 (–≤—ã—Å–æ—Ç–∞/—à–∏—Ä–∏–Ω–∞)
maxHoleDensity: 2 –æ—Ç–≤–µ—Ä—Å—Ç–∏—è –Ω–∞ —Å–º¬≤
minDistanceBetweenHoles: 5–º–º
```

### Severity —É—Ä–æ–≤–Ω–∏

- üî¥ CRITICAL ‚Äî –∏–∑–¥–µ–ª–∏–µ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏
- üü† ERROR ‚Äî —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∏
- üü° WARNING ‚Äî –Ω–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ, –Ω–æ –≤—ã–ø–æ–ª–Ω–∏–º–æ
- üîµ INFO ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è

---

## 8. Zustand Store (projectStore)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è

```typescript
ProjectState {
  // 3D Data
  panels: Panel[]
  layers: Layer[]
  selectedPanelId: string | null
  
  // CAD Data (Phases 2-5)
  solvedAssembly: Assembly | null
  bomData: BOMHierarchy | null
  dfmReport: DFMReport | null
  feaResults: FEAResult | null
  optimizationResults: OptimizationResult | null
  
  // Manufacturing
  currentGlobalStage: ProductionStage
  
  // History (Undo/Redo)
  history: Panel[][]
  historyIndex: number
}
```

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

- ‚úÖ Undo/Redo —á–µ—Ä–µ–∑ history stack
- ‚úÖ Batch –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è `bulkUpdatePanels()`
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ `validatePanelUpdate()`
- ‚úÖ Toast —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- ‚úÖ Global production stage tracking

### –ü—Ä–æ–±–ª–µ–º—ã

**1. ‚ùå History –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—á–µ–Ω—å –±–æ–ª—å—à–æ–π –≤ –ø–∞–º—è—Ç–∏**
```typescript
// –ö–∞–∂–¥—ã–π pushHistory() —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤–µ—Å—å –º–∞—Å—Å–∏–≤ panels
// –î–ª—è 100 –æ–ø–µ—Ä–∞—Ü–∏–π: 100 * panels.length * Panel —Ä–∞–∑–º–µ—Ä
// –ù—É–∂–Ω–∞ –¥–µ–ª—å—Ç–∞ compression
```

**2. ‚ùå –ù–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
```typescript
// –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±–Ω–æ–≤–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—É, –¥–∞–Ω–Ω—ã–µ –ø–æ—Ç–µ—Ä—è—é—Ç—Å—è
// –ù—É–∂–Ω–æ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
```

---

## 9. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏

### Data Flow

```
User Input (UI)
    ‚Üì
InputValidator (–≤–∞–ª–∏–¥–∞—Ü–∏—è)
    ‚Üì
CabinetGenerator (generate panels)
    ‚Üì
ConstraintSolver (optimize positions)
    ‚Üì
ProjectStore (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç panels)
    ‚Üì
[–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ]
‚îú‚Üí BillOfMaterials (—Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏)
‚îú‚Üí DFMValidator (–ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç–∏)
‚îú‚Üí FEAIntegration (—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑)
‚îî‚Üí geminiService (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–∏–∑–∞–π–Ω–∞)
    ‚Üì
Scene3D / Scene3DBabylon (–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
```

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

**1. Panel ‚Üí Assembly –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ** (CabinetGenerator.panelsToAssembly)
- –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç Panel[16–º–º —Ç–æ–ª—â–∏–Ω–∞] ‚Üí Component[—Å AnchorPoint –Ω–∞ –≤–µ—Ä—à–∏–Ω–∞—Ö]
- –î–æ–±–∞–≤–ª—è–µ—Ç constraints (FIXED, DISTANCE, PARALLEL, PERPENDICULAR)

**2. Assembly ‚Üí BOM** (BillOfMaterials)
- –ò–µ—Ä–∞—Ä—Ö–∏—è: Assembly ‚Üí rootComponent ‚Üí children components ‚Üí materials
- –†–∞—Å—á–µ—Ç volume = component.dimensions.width * height * depth
- –†–∞—Å—á–µ—Ç mass = volume * material.density

---

## 10. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (Jest)

### –ü–æ–∫—Ä—ã—Ç—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ (16 —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤)

| –§–∞–π–ª | –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------|---------------|--------|
| CabinetGenerator.test.ts | generate(), panels, hardware | ‚úÖ 14 —Ç–µ—Å—Ç–æ–≤ |
| ConstraintSolver.test.ts | Newton-Raphson, LU, jacobian | ‚úÖ 37 —Ç–µ—Å—Ç–æ–≤ |
| BillOfMaterials.test.ts | BOM —Ä–∞—Å—á–µ—Ç—ã, –∏–µ—Ä–∞—Ä—Ö–∏—è | ‚úÖ 21 —Ç–µ—Å—Ç |
| DFMValidator.test.ts | DFM –ø—Ä–æ–≤–µ—Ä–∫–∏, rules | ‚úÖ 17 —Ç–µ—Å—Ç–æ–≤ |
| FEAIntegration.test.ts | –°–∏–º—É–ª—è—Ü–∏—è, –Ω–∞–≥—Ä—É–∑–∫–∏ | ‚úÖ 24 —Ç–µ—Å—Ç–∞ |
| CADExporterImporter.test.ts | Export/Import CAD | ‚úÖ 28 —Ç–µ—Å—Ç–æ–≤ |

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

```typescript
describe('CabinetGenerator', () => {
  it('should generate valid panels with correct dimensions', () => {
    const gen = new CabinetGenerator(config, sections, materials);
    const panels = gen.generate();
    expect(panels.length).toBeGreaterThan(0);
    panels.forEach(p => {
      expect(p.width).toBeGreaterThan(0);
      expect(p.height).toBeGreaterThan(0);
      expect(p.depth).toBeGreaterThan(0);
    });
  });
});
```

---

## 11. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

**‚úÖ ParameterCache –≤ CabinetGenerator**
- Hit rate: 55% –¥–ª—è —Ç–∏–ø–æ–≤—ã—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π
- –£–º–µ–Ω—å—à–∞–µ—Ç –≤—Ä–µ–º—è generate() –Ω–∞ 30-40%

**‚úÖ Web Worker –¥–ª—è 2D Nesting (nesting.worker.js)**
- –ù–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç UI –≤–æ –≤—Ä–µ–º—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞—Å–∫—Ä–æ—è
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç guillotine –∞–ª–≥–æ—Ä–∏—Ç–º

**‚úÖ –ú–µ–º–æ–∏–∑–∞—Ü–∏—è –≤ geminiService**
- –ö–µ—à–∏—Ä—É–µ—Ç —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ prompt responses

### Bottlenecks

**1. ‚ùå ConstraintSolver –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ–¥–ª–µ–Ω–Ω—ã–º**
- Newton-Raphson —Å numerical jacobian: O(n¬≥) –Ω–∞ –∏—Ç–µ—Ä–∞—Ü–∏—é
- –î–ª—è 50+ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 2-5 —Å–µ–∫

**2. ‚ùå FEAIntegration –º–æ–∂–µ—Ç –∑–∞–≤–∏—Å–Ω—É—Ç—å**
- Matrix decomposition –¥–ª—è FEA —Ç—Ä–µ–±—É–µ—Ç O(n¬≥) –æ–ø–µ—Ä–∞—Ü–∏–π
- –ù—É–∂–Ω–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ

---

## 12. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é (Priority)

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (—Å—Ä–æ—á–Ω–æ)

1. **–î–æ–±–∞–≤–∏—Ç—å –≤—Ö–æ–¥–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é** –≤ CabinetGenerator
2. **–†–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏—è Jacobian** –≤ ConstraintSolver
3. **Timeout –¥–ª—è Gemini** –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–í–∞–ª–∏–¥–∞—Ü–∏—è JSON** –∏–∑ Gemini

### üü† –í—ã—Å–æ–∫–∏–µ (–≤–∞–∂–Ω–æ)

5. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è ParameterCache –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ config
6. Dependency Injection –¥–ª—è ConstraintSolver
7. –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ Gemini –∑–∞–ø—Ä–æ—Å–æ–≤ (LRU)
8. Line search –≤ ConstraintSolver

### üü° –°—Ä–µ–¥–Ω–∏–µ (–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ)

9. History compression –≤ Store
10. Auto-save –≤ localStorage
11. –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π stepSize –≤ Solver
12. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è HARDWARE_CONFIG

### üîµ –ù–∏–∑–∫–∏–µ (nice-to-have)

13. Context-aware prompting –≤ Gemini
14. Multi-language support –¥–ª—è DFM —Å–æ–æ–±—â–µ–Ω–∏–π
15. –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CAD —Å–µ—Ä–≤–∏—Å–æ–≤
16. –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤ PerformanceMonitor

---

## –í—ã–≤–æ–¥—ã

**BazisLite-Web** –∏–º–µ–µ—Ç **solid –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —Ö–æ—Ä–æ—à–µ–π —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç:
- ‚úÖ –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –£–ª—É—á—à–µ–Ω–∏–π —á–∏—Å–ª–µ–Ω–Ω–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ ConstraintSolver
- ‚úÖ –õ—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ AI —Å–µ—Ä–≤–∏—Å–∞
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –¥–ª—è –±–æ–ª—å—à–∏—Ö —Å–±–æ—Ä–æ–∫

**–ù–∞–∏–±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è**:
1. CabinetGenerator ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π "–¥–≤–∏–∂–æ–∫" –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
2. ConstraintSolver ‚Äî –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —è–¥—Ä–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. geminiService ‚Äî AI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
4. ProjectStore ‚Äî state management
5. –¢–µ—Å—Ç—ã ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ–≤–µ–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã
