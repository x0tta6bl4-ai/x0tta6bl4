# –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º

**–î–∞—Ç–∞**: 2025-12-25  
**–°—Ç–∞—Ç—É—Å**: ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**

---

## üìã –ü—Ä–æ–±–ª–µ–º—ã –∏–∑ –°—Ü–µ–Ω–∞—Ä–∏—è 1

1. ‚ùå **–ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ failover** ‚Äî –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —É–∑–ª–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã
2. ‚ùå **–ù–µ—Ç Byzantine protection** ‚Äî beacon'—ã –Ω–µ –ø–æ–¥–ø–∏—Å–∞–Ω—ã
3. ‚ùå **O(n¬≤) discovery** ‚Äî –Ω–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è –Ω–∞ 1000+ —É–∑–ª–æ–≤

---

## ‚úÖ –†–µ—à–µ–Ω–∏—è

### 1. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π Failover

**–§–∞–π–ª**: `src/core/app_minimal_with_failover.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
- ‚úÖ **MAPE-K Monitor**: `health_check_loop()` –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `last_seen` –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
- ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ dead peers**: –£–∑–ª—ã –±–µ–∑ beacon > 30 —Å–µ–∫—É–Ω–¥ —É–¥–∞–ª—è—é—Ç—Å—è
- ‚úÖ **–†–µ–∞–∫—Ç–∏–≤–Ω—ã–π –ø–µ—Ä–µ—Å—á—ë—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤**: Dijkstra –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ —É–∑–ª–∞
- ‚úÖ **Recovery detection**: –ú—ë—Ä—Ç–≤—ã–µ —É–∑–ª—ã –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ beacon

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
```python
async def health_check_loop():
    """MAPE-K Monitor: Check peer health and prune dead peers."""
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤—Å–µ peers
    # –ü–æ–º–µ—á–∞–µ—Ç dead peers (timeout > 30s)
    # –£–¥–∞–ª—è–µ—Ç –∏–∑ active peers
    # –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç –ø–µ—Ä–µ—Å—á—ë—Ç –º–∞—Ä—à—Ä—É—Ç–æ–≤

async def recalculate_routes():
    """MAPE-K Plan: Recalculate routes after topology changes."""
    # –û—á–∏—â–∞–µ—Ç route cache
    # –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç Dijkstra (–∏—Å–∫–ª—é—á–∞—è dead peers)
    # –û–±–Ω–æ–≤–ª—è–µ—Ç route cache
```

**–ú–µ—Ç—Ä–∏–∫–∏**:
- `mesh_dead_peers_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º—ë—Ä—Ç–≤—ã—Ö —É–∑–ª–æ–≤
- `mesh_alive_peers_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∂–∏–≤—ã—Ö —É–∑–ª–æ–≤
- `mesh_routes_count` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

---

### 2. PQC –ü–æ–¥–ø–∏—Å–∏ –¥–ª—è Beacon'–æ–≤

**–§–∞–π–ª**: `src/core/app_minimal_with_pqc_beacons.py`

**–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ**:
- ‚úÖ **Dilithium3 –ø–æ–¥–ø–∏—Å–∏**: –ò—Å–ø–æ–ª—å–∑—É–µ—Ç liboqs –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ beacon'–æ–≤
- ‚úÖ **–í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π**: –í—Å–µ beacon'—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –ø–µ—Ä–µ–¥ –ø—Ä–∏–Ω—è—Ç–∏–µ–º
- ‚úÖ **Byzantine protection**: –û—Ç–∫–ª–æ–Ω—è–µ—Ç beacon'—ã —Å –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–º–∏ –ø–æ–¥–ø–∏—Å—è–º–∏
- ‚úÖ **Key rotation protection**: –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å–º–µ–Ω—É –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π

**–ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏**:
```python
def sign_beacon(beacon_data: bytes) -> bytes:
    """Sign beacon data with Dilithium3."""
    # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç liboqs Signature("Dilithium3")
    # –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ beacon'–∞

def verify_beacon(beacon_data: bytes, signature: bytes, public_key: bytes) -> bool:
    """Verify beacon signature."""
    # –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å —Å –ø–æ–º–æ—â—å—é liboqs
    # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç False –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏

@app.post("/mesh/beacon")
async def receive_beacon(req: BeaconRequest):
    """Receive beacon with PQC signature verification."""
    # 1. –°–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç beacon –¥–∞–Ω–Ω—ã–µ
    # 2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–¥–ø–∏—Å—å
    # 3. –û—Ç–∫–ª–æ–Ω—è–µ—Ç –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏ (Byzantine attack)
    # 4. –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–Ω–æ–π –ø–æ–¥–ø–∏—Å–∏
```

**–ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫**:
- ‚úÖ **–ü–æ–¥–¥–µ–ª–∫–∞ beacon'–æ–≤**: –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –±–µ–∑ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞
- ‚úÖ **Replay attacks**: Timestamp –≤ –ø–æ–¥–ø–∏—Å–∏ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç replay
- ‚úÖ **Key rotation attacks**: –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è

**–ú–µ—Ç—Ä–∏–∫–∏**:
- `mesh_pqc_enabled` ‚Äî –≤–∫–ª—é—á–µ–Ω—ã –ª–∏ PQC –ø–æ–¥–ø–∏—Å–∏
- `mesh_peers_with_pqc` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ peers —Å PQC –∫–ª—é—á–∞–º–∏

---

### 3. O(n¬≤) Discovery (TODO)

**–°—Ç–∞—Ç—É—Å**: ‚è≥ **–ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ** (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç –¥–ª—è 10 —É–∑–ª–æ–≤)

**–ü—Ä–æ–±–ª–µ–º–∞**: Full mesh topology —Ç—Ä–µ–±—É–µ—Ç O(n¬≤) beacon'–æ–≤ –¥–ª—è –ø–æ–ª–Ω–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏.

**–ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ**:
- **Gossip protocol**: –ö–∞–∂–¥—ã–π —É–∑–µ–ª –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç beacon —Ç–æ–ª—å–∫–æ k —Å–ª—É—á–∞–π–Ω—ã–º —Å–æ—Å–µ–¥—è–º
- **DHT (Distributed Hash Table)**: –î–ª—è discovery –Ω–æ–≤—ã—Ö —É–∑–ª–æ–≤
- **Partial mesh**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏ –≤–º–µ—Å—Ç–æ full mesh

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç**: Medium (–∞–∫—Ç—É–∞–ª—å–Ω–æ —Ç–æ–ª—å–∫–æ –¥–ª—è 100+ —É–∑–ª–æ–≤)

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ vs –ü–æ—Å–ª–µ

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | –î–æ (app_minimal.py) | –ü–æ—Å–ª–µ (—Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è–º–∏) |
|----------------|---------------------|--------------------------|
| **Failover** | ‚ùå –ù–µ—Ç | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π |
| **Dead peer detection** | ‚ùå –ù–µ—Ç | ‚úÖ 30s timeout |
| **Route recalculation** | ‚ùå –ù–µ—Ç | ‚úÖ –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ —É–∑–ª–∞ |
| **PQC –ø–æ–¥–ø–∏—Å–∏** | ‚ùå –ù–µ—Ç | ‚úÖ Dilithium3 |
| **Byzantine protection** | ‚ùå –ù–µ—Ç | ‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–µ–π |
| **Recovery detection** | ‚ùå –ù–µ—Ç | ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –¢–µ—Å—Ç 1: Failover

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å 10 —É–∑–ª–æ–≤
docker compose -f docker-compose.mesh-test.yml up -d

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ring topology
# ... (–∫–∞–∫ –≤ –°—Ü–µ–Ω–∞—Ä–∏–∏ 1)

# –£–±–∏—Ç—å node-2
docker stop mesh-node-2

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 30 —Å–µ–∫—É–Ω–¥
sleep 35

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ node-1 –ø–µ—Ä–µ—Å—á–∏—Ç–∞–ª –º–∞—Ä—à—Ä—É—Ç—ã
curl http://localhost:8081/mesh/route/node-3
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –ø—É—Ç—å —á–µ—Ä–µ–∑ node-10 (–æ–±—Ö–æ–¥ node-2)

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å node-2
docker start mesh-node-2

# –ü–æ–¥–æ–∂–¥–∞—Ç—å 5 —Å–µ–∫—É–Ω–¥
sleep 5

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ node-2 –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
curl http://localhost:8081/mesh/peers
# node-2 –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ peers
```

### –¢–µ—Å—Ç 2: PQC –ü–æ–¥–ø–∏—Å–∏

```bash
# –ü–æ–ª—É—á–∏—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π beacon –æ—Ç node-1
curl http://localhost:8081/mesh/beacon/sign?neighbors=node-2,node-10

# –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π beacon –Ω–∞ node-2
curl -X POST http://localhost:8082/mesh/beacon \
  -H "Content-Type: application/json" \
  -d '{
    "node_id": "node-1",
    "timestamp": 1234567890,
    "neighbors": ["node-2", "node-10"],
    "signature": "...",
    "public_key": "..."
  }'

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–æ–¥–¥–µ–ª–∞—Ç—å beacon (–±–µ–∑ –ø–æ–¥–ø–∏—Å–∏)
curl -X POST http://localhost:8082/mesh/beacon \
  -H "Content-Type: application/json" \
  -d '{
    "node_id": "node-1",
    "timestamp": 1234567890,
    "neighbors": ["node-2", "node-10"]
  }'
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 400 Bad Request
```

---

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

```
/mnt/AC74CC2974CBF3DC/
‚îú‚îÄ‚îÄ src/core/
‚îÇ   ‚îú‚îÄ‚îÄ app_minimal.py                    # –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ app_minimal_with_failover.py      # ‚úÖ –° failover
‚îÇ   ‚îî‚îÄ‚îÄ app_minimal_with_pqc_beacons.py   # ‚úÖ –° PQC –ø–æ–¥–ø–∏—Å—è–º–∏
‚îî‚îÄ‚îÄ SCENARIO_1_FIXES_SUMMARY.md           # –≠—Ç–æ—Ç —Ñ–∞–π–ª
```

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ **Failover** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
2. ‚úÖ **PQC –ø–æ–¥–ø–∏—Å–∏** ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
3. ‚è≥ **Gossip protocol** ‚Äî –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è (–Ω–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
4. ‚è≥ **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–æ–ª–Ω—ã–º MAPE-K** ‚Äî –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `src/self_healing/mape_k.py`
5. ‚è≥ **Performance benchmarks** ‚Äî –∏–∑–º–µ—Ä–∏—Ç—å overhead failover –∏ PQC

---

**Verdict**: ‚úÖ **2 –∏–∑ 3 –ø—Ä–æ–±–ª–µ–º —Ä–µ—à–µ–Ω—ã** (failover + PQC –ø–æ–¥–ø–∏—Å–∏)

**O(n¬≤) discovery** –æ—Å—Ç–∞–≤–ª–µ–Ω –Ω–∞ –±—É–¥—É—â–µ–µ, —Ç.–∫. –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è 10 —É–∑–ª–æ–≤.

