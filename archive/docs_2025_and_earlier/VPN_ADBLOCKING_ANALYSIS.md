# üîç –ê–Ω–∞–ª–∏–∑ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –†–µ–∫–ª–∞–º—ã –Ω–∞ VPN –°–µ—Ä–≤–µ—Ä–µ

## üìä –¢–µ–∫—É—â–µ–µ –°–æ—Å—Ç–æ—è–Ω–∏–µ

### ‚úÖ –ß—Ç–æ –ï—Å—Ç—å:

1. **Outbound "blocked" (blackhole)** ‚úÖ
   - –ü—Ä–æ—Ç–æ–∫–æ–ª: `blackhole` - "—á–µ—Ä–Ω–∞—è –¥—ã—Ä–∞" –¥–ª—è –±–ª–æ–∫–∏—Ä—É–µ–º–æ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞
   - –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –¢—Ä–∞—Ñ–∏–∫ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å—é–¥–∞ –∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

2. **DNS —Å–µ—Ä–≤–µ—Ä—ã** ‚ö†Ô∏è
   - **–¢–µ–∫—É—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
     ```json
     "dns": {
       "servers": [
         "1.1.1.1",    // Cloudflare DNS
         "8.8.8.8",    // Google DNS
         "1.0.0.1"     // Cloudflare DNS
       ]
     }
     ```
   - ‚ùå **AdGuard DNS –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** - –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã –Ω–∞ DNS —É—Ä–æ–≤–Ω–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç!
   - –í –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`xray_full_reinstall.sh`) –±—ã–ª AdGuard DNS, –Ω–æ —Å–µ–π—á–∞—Å –µ–≥–æ –Ω–µ—Ç

### ‚ùå –ß—Ç–æ –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç:

1. **Routing Rules –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã** ‚ùå
   - –í –∏—Å—Ö–æ–¥–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –±—ã–ª–∏ –ø—Ä–∞–≤–∏–ª–∞:
     ```json
     "routing": {
       "rules": [
         { 
           "type": "field", 
           "outboundTag": "blocked", 
           "domainKeyword": ["ad","ads","doubleclick","googlesyndication"] 
         },
         { 
           "type": "field", 
           "protocol": ["bittorrent"], 
           "outboundTag": "blocked" 
         },
         { 
           "type": "field", 
           "ip": ["geoip:private"], 
           "outboundTag": "blocked" 
         }
       ]
     }
     ```
   - **–°–µ–π—á–∞—Å —ç—Ç–∏ –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç!**

2. **DNS Hosts –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** ‚ùå
   - –ù–µ—Ç –ø—Ä–∞–≤–∏–ª –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤ –Ω–∞ `0.0.0.0`

---

## üîß –ö–∞–∫ –£—Å—Ç—Ä–æ–µ–Ω–∞ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞

### 1. **DNS-—É—Ä–æ–≤–µ–Ω—å (AdGuard DNS)**
```
–ö–ª–∏–µ–Ω—Ç ‚Üí VPN ‚Üí AdGuard DNS ‚Üí –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
```
- AdGuard DNS –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±–ª–æ–∫–∏—Ä—É–µ—Ç –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –¥–æ–º–µ–Ω—ã
- –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —É—Ä–æ–≤–Ω–µ DNS-–∑–∞–ø—Ä–æ—Å–æ–≤

### 2. **Routing-—É—Ä–æ–≤–µ–Ω—å (Xray Rules)**
```
–¢—Ä–∞—Ñ–∏–∫ ‚Üí Routing Rules ‚Üí –ï—Å–ª–∏ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚Üí Outbound "blocked" ‚Üí Blackhole
```
- –ü—Ä–∞–≤–∏–ª–∞ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –¥–æ–º–µ–Ω—ã/–∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è—é—Ç –Ω–∞ `blackhole` outbound
- –¢—Ä–∞—Ñ–∏–∫ –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è

### 3. **Blackhole Outbound**
- –ü—Ä–æ—Ç–æ–∫–æ–ª `blackhole` - "—á–µ—Ä–Ω–∞—è –¥—ã—Ä–∞"
- –¢—Ä–∞—Ñ–∏–∫ –ø–æ–ø–∞–¥–∞–µ—Ç —Å—é–¥–∞ –∏ –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –¥–∞–ª—å—à–µ

---

## üìã –¢–µ–∫—É—â–∞—è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Outbounds:
```json
{
  "outbounds": [
    { "protocol": "freedom", "tag": "direct" },
    { "protocol": "blackhole", "tag": "blocked" }
  ]
}
```

### Routing Rules:
```json
{
  "routing": {
    "rules": [
      { "type": "field", "inboundTag": ["api"], "outboundTag": "api" }
    ]
  }
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ù–µ—Ç –ø—Ä–∞–≤–∏–ª –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã!

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ AdGuard DNS (—Ç–µ–∫—É—â–∏–π)
- ‚úÖ –£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ DNS
- ‚úÖ –ü—Ä–æ—Å—Ç–æ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
- ‚ùå –ú–æ–∂–µ—Ç –ø—Ä–æ–ø—É—Å–∫–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–∫–ª–∞–º–Ω—ã–µ –¥–æ–º–µ–Ω—ã

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å Routing Rules (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ Xray
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ BitTorrent
- ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö IP

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥
- ‚úÖ AdGuard DNS + Routing Rules
- ‚úÖ –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞

---

## üõ†Ô∏è –ö–∞–∫ –í–∫–ª—é—á–∏—Ç—å –ü–æ–ª–Ω—É—é –ë–ª–æ–∫–∏—Ä–æ–≤–∫—É

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í–∫–ª—é—á–∏—Ç—å AdGuard DNS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ò–∑–º–µ–Ω–∏—Ç—å DNS —Å–µ—Ä–≤–µ—Ä—ã –≤ `/usr/local/x-ui/bin/config.json`:
```json
{
  "dns": {
    "queryStrategy": "UseIPv4",
    "servers": [
      { "address": "https://dns.adguard.com/dns-query" },
      "https://1.1.1.1/dns-query",
      "https://dns.google/dns-query"
    ]
  }
}
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Xray:
```bash
systemctl restart xray
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –î–æ–±–∞–≤–∏—Ç—å Routing Rules

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∞–≤–∏—Ç—å routing rules –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–µ–∫–ª–∞–º—ã, –Ω—É–∂–Ω–æ:

1. –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –≤ `/usr/local/x-ui/bin/config.json`:
```json
{
  "routing": {
    "rules": [
      { "type": "field", "inboundTag": ["api"], "outboundTag": "api" },
      { 
        "type": "field", 
        "outboundTag": "blocked", 
        "domainKeyword": ["ad", "ads", "doubleclick", "googlesyndication", "adservice", "advertising", "adserver"]
      },
      { 
        "type": "field", 
        "protocol": ["bittorrent"], 
        "outboundTag": "blocked" 
      },
      { 
        "type": "field", 
        "ip": ["geoip:private"], 
        "outboundTag": "blocked" 
      }
    ]
  }
}
```

2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å Xray:
```bash
systemctl restart xray
```

---

## üìä –ò—Ç–æ–≥

**–¢–µ–∫—É—â–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:**
- ‚ùå AdGuard DNS (–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è)
- ‚ùå Routing Rules (–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç)

**–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** ~0% (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–µ–∫–ª–∞–º—ã –ù–ï —Ä–∞–±–æ—Ç–∞–µ—Ç!)

**–° Routing Rules:** ~95-98% (DNS + Routing)

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞

–ß—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:
```bash
# –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ —á–µ—Ä–µ–∑ VPN
curl -v http://doubleclick.net
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Ç–∞–π–º–∞—É—Ç
```

