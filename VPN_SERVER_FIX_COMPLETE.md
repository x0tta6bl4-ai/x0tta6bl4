# ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ VPN –°–µ—Ä–≤–µ—Ä–∞ - –§–∏–Ω–∞–ª—å–Ω—ã–π –û—Ç—á–µ—Ç

## üî¥ –ü—Ä–æ–±–ª–µ–º—ã –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã

1. **Xray –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ systemd**
   - –ü–æ—Ä—Ç 62789 (API) –∑–∞–Ω—è—Ç
   - –ü–æ—Ä—Ç 39829 –∑–∞–Ω—è—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ–º –æ—Ç x-ui

2. **–ö–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ `direct`**
   - –û—à–∏–±–∫–∞: `dial tcp 89.125.1.107:39829: connect: connection refused`
   - –ö–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `outbound/direct[direct]` –≤–º–µ—Å—Ç–æ proxy

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ü—Ä–∏–º–µ–Ω–µ–Ω—ã

### 1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Routing ‚úÖ

**–î–æ–±–∞–≤–ª–µ–Ω–æ –ø—Ä–∞–≤–∏–ª–æ:**
```json
{
  "type": "field",
  "ip": ["89.125.1.107/32"],
  "outboundTag": "proxy"
}
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** VPN —Å–µ—Ä–≤–µ—Ä –≤—Å–µ–≥–¥–∞ –∏–¥–µ—Ç —á–µ—Ä–µ–∑ proxy (–Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ).

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ geosite:ru ‚úÖ

**–ó–∞–º–µ–Ω–µ–Ω–æ –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–æ–º–µ–Ω—ã:**
- 18 —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –¥–æ–º–µ–Ω–æ–≤ –≤–º–µ—Å—Ç–æ `geosite:ru`
- –ë–∞–Ω–∫–∏, –≥–æ—Å—É—Å–ª—É–≥–∏, –Ø–Ω–¥–µ–∫—Å –∏ —Ç.–¥.

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∞—è –ü—Ä–æ–±–ª–µ–º–∞

**–ü—Ä–æ—Ü–µ—Å—Å x-ui –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç—ã:**
- –ü—Ä–æ—Ü–µ—Å—Å: `xray-linux-amd64` (PID 1341765)
- –ü–æ—Ä—Ç 39829: –∑–∞–Ω—è—Ç
- –ü–æ—Ä—Ç 62789: –∑–∞–Ω—è—Ç

**–†–µ—à–µ–Ω–∏–µ:**

```bash
ssh root@89.125.1.107

# –£–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å x-ui
killall -9 xray-linux-amd64

# –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç—ã
lsof -ti:62789 | xargs kill -9
lsof -ti:39829 | xargs kill -9

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —á–µ—Ä–µ–∑ systemd
systemctl reset-failed xray
systemctl start xray
sleep 5
systemctl status xray
ss -tlnp | grep 39829
```

---

## üîß –ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ –ö–ª–∏–µ–Ω—Ç–µ

**–ö–ª–∏–µ–Ω—Ç –ø—ã—Ç–∞–µ—Ç—Å—è –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ `direct`:**

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç —á—Ç–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ (v2rayN) –µ—Å—Ç—å –ø—Ä–∞–≤–∏–ª–æ routing –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç—Ä–∞—Ñ–∏–∫ –∫ 89.125.1.107 –Ω–∞–ø—Ä—è–º—É—é.

**–†–µ—à–µ–Ω–∏–µ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ:**

1. –û—Ç–∫—Ä–æ–π—Ç–µ v2rayN
2. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí Routing
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª–∞ –∫–æ—Ç–æ—Ä–æ–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 89.125.1.107 —á–µ—Ä–µ–∑ `direct`
4. –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –ø—Ä–∞–≤–∏–ª–æ: IP `89.125.1.107` ‚Üí `proxy`

---

## ‚úÖ –°—Ç–∞—Ç—É—Å

**–°–µ—Ä–≤–µ—Ä:**
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ Routing rules –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç—ã –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å

**–ö–ª–∏–µ–Ω—Ç:**
- ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å routing rules –≤ v2rayN

---

## üìã –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–ù–∞ —Å–µ—Ä–≤–µ—Ä–µ:**

```bash
# –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç—ã
killall -9 xray-linux-amd64
lsof -ti:62789 | xargs kill -9
lsof -ti:39829 | xargs kill -9

# –ó–∞–ø—É—Å—Ç–∏—Ç—å Xray
systemctl reset-failed xray
systemctl start xray
sleep 5
systemctl status xray
```

**–ù–∞ –∫–ª–∏–µ–Ω—Ç–µ (v2rayN):**

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ routing rules - —É–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ 89.125.1.107 –∏–¥–µ—Ç —á–µ—Ä–µ–∑ proxy, –∞ –Ω–µ direct.

---

## ‚úÖ –ü–æ—Å–ª–µ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- ‚úÖ Xray —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ systemd
- ‚úÖ –ü–æ—Ä—Ç 39829 —Å–ª—É—à–∞–µ—Ç—Å—è
- ‚úÖ –ö–ª–∏–µ–Ω—Ç –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ proxy
- ‚úÖ VPN —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üìù –§–∞–π–ª—ã

**–°–∫—Ä–∏–ø—Ç—ã:**
- `fix_vpn_connection_refused.sh` - –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫

**–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
- `/usr/local/etc/xray/config.json` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è

**–ë—ç–∫–∞–ø—ã:**
- `/usr/local/etc/xray/config.json.backup_*` - –±—ç–∫–∞–ø—ã

---

## ‚úÖ –ò—Ç–æ–≥

**–ü—Ä–æ–±–ª–µ–º—ã:** ‚úÖ **–ò–î–ï–ù–¢–ò–§–ò–¶–ò–†–û–í–ê–ù–´**

1. –°–µ—Ä–≤–µ—Ä: –ø–æ—Ä—Ç—ã –∑–∞–Ω—è—Ç—ã –ø—Ä–æ—Ü–µ—Å—Å–æ–º x-ui - —Ç—Ä–µ–±—É–µ—Ç—Å—è –æ—Å–≤–æ–±–æ–¥–∏—Ç—å
2. –ö–ª–∏–µ–Ω—Ç: routing rules –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç 89.125.1.107 —á–µ—Ä–µ–∑ direct - —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–∏—Ç—å

**–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è VPN –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç!** üöÄ

