---
# Charter Policy - Production Environment
# Use: live network, restricted metrics, strict approval requirements

charter:
  version: "1.0.0"
  name: "prod-charter"
  effective_date: "2026-02-15"  # After Phase 0 completion
  metadata:
    environment: "production"
    status: "pending"  # Awaiting board approval on 2026-01-18
    created_by: "platform_team"
    requires_approval: true
    approved_by: []  # Will be filled by board
    approval_date: null

whitelisted_metrics:
  network:
    - metric_name: "latency_p50"
      access_level: "public"
      retention_days: 30
    - metric_name: "latency_p95"
      access_level: "public"
      retention_days: 30
    - metric_name: "latency_p99"
      access_level: "public"
      retention_days: 30
    - metric_name: "packet_loss_percent"
      access_level: "public"
      retention_days: 7
    - metric_name: "throughput_mbps"
      access_level: "public"
      retention_days: 30
    - metric_name: "connection_uptime_percent"
      access_level: "audit_only"
      retention_days: 90
  
  infrastructure:
    - metric_name: "cpu_usage_percent"
      access_level: "node_operator"
      retention_days: 14  # Reduced from 30
    - metric_name: "memory_usage_percent"
      access_level: "node_operator"
      retention_days: 14
    - metric_name: "disk_usage_percent"
      access_level: "node_operator"
      retention_days: 7
    - metric_name: "network_interface_status"
      access_level: "node_operator"
      retention_days: 30  # Reduced from 90
  
  service:
    - metric_name: "api_requests_per_second"
      access_level: "public"
      retention_days: 7
    - metric_name: "error_rate_percent"
      access_level: "public"
      retention_days: 7
    - metric_name: "service_version"
      access_level: "public"
      retention_days: 1000

forbidden_metrics:
  - metric_name: "user_location"
    penalty: "CRITICAL"
    reason: "Privacy violation: location tracking prohibited"
    auto_shutdown: true  # Automatic service halt
  - metric_name: "user_identity"
    penalty: "CRITICAL"
    reason: "Privacy violation: identity disclosure prohibited"
    auto_shutdown: true
  - metric_name: "browsing_history"
    penalty: "CRITICAL"
    reason: "Privacy violation: browsing data prohibited"
    auto_shutdown: true
  - metric_name: "device_hardware_id"
    penalty: "HIGH"
    reason: "Device fingerprinting prohibited"
    auto_shutdown: false
  - metric_name: "user_communication_metadata"
    penalty: "HIGH"
    reason: "Communication patterns leakage prohibited"
    auto_shutdown: false
  - metric_name: "system_logs_with_user_data"
    penalty: "HIGH"
    reason: "Unredacted logs containing user data prohibited"
    auto_shutdown: false

access_control:
  read_access:
    - role: "public"
      can_access: ["latency_p50", "latency_p95", "latency_p99", "packet_loss_percent", 
                   "throughput_mbps", "api_requests_per_second", "error_rate_percent", 
                   "service_version"]
      rate_limit_per_hour: 10000
    - role: "node_operator"
      can_access: ["latency_p50", "latency_p95", "latency_p99", "packet_loss_percent", 
                   "throughput_mbps", "cpu_usage_percent", "memory_usage_percent", 
                   "disk_usage_percent", "network_interface_status", "api_requests_per_second",
                   "error_rate_percent", "service_version"]
      rate_limit_per_hour: 100000
    - role: "audit_committee_member"
      can_access: ["*"]  # All metrics except explicitly forbidden ones
      requires_approval: true
      approval_ttl_hours: 24
      rate_limit_per_hour: 50000
    - role: "emergency_responder"
      can_access: ["*"]
      requires_renewal_hours: 2
      auto_revoke_hours: 12  # Shorter in production
      rate_limit_per_hour: 200000

  write_access:
    - role: "node_operator"
      can_write: ["latency_p50", "latency_p95", "latency_p99", "packet_loss_percent", 
                  "throughput_mbps", "cpu_usage_percent", "memory_usage_percent", 
                  "disk_usage_percent", "network_interface_status"]
      write_rate_limit_per_minute: 1000
      requires_approval: false
    - role: "monitoring_service"
      can_write: ["api_requests_per_second", "error_rate_percent", "service_version"]
      write_rate_limit_per_minute: 10000
      requires_approval: false

violation_policy:
  response:
    - level: 1
      action: "LOG_AND_ALERT"
      alert_destination: ["security_team"]
      slack_channel: "#security-violations"
      block_collection: false
      incident_severity: "LOW"
    - level: 2
      action: "BLOCK_AND_SUSPEND"
      suspension_duration_hours: 24
      alert_destination: ["security_team", "dao_council"]
      slack_channel: "#critical-incidents"
      incident_severity: "MEDIUM"
      requires_manual_override: true
    - level: 3
      action: "NODE_QUARANTINE"
      requires_dao_vote: true
      alert_destination: ["dao_council", "board"]
      slack_channel: "#critical-incidents"
      incident_severity: "HIGH"
      pagerduty_alert: true
    - level: 4
      action: "LEGAL_ESCALATION"
      requires_board_approval: true
      alert_destination: ["board", "legal_team", "ciso"]
      slack_channel: "#board-alerts"
      incident_severity: "CRITICAL"
      pagerduty_alert: true
      notify_regulators: true
  
  audit_trail:
    enabled: true
    immutable: true  # Production: immutable
    signing_required: true
    signing_algorithm: "ECDSA"
    backup_locations:
      - "postgresql"
      - "arweave"  # Permanent storage
    retention_years: 7

whistleblower_policy:
  anonymous_reporting: true
  bounty_enabled: true
  bounty_amount_usd: 10000  # Increased from 1000
  reporting_channels:
    - "https://x0tta6bl4.io/report (Tor available)"
    - "signal://+1-privacy-hotline"
    - "email://security@x0tta6bl4.io (PGP)"
  response_sla_hours: 24
  bounty_processing_days: 7

emergency_override:
  enabled: true
  requires_dao_vote: true  # DAO approval mandatory
  requires_board_approval: false  # DAO is sufficient
  auto_renewal_hours: 2
  full_audit_trail_required: true
  requires_minimum_quorum_percent: 66  # 66% quorum minimum
  approval_required_roles: ["emergency_responder"]
  post_override_audit: true

enforcement:
  enabled: true  # Production: active enforcement
  hooks:
    - type: "prometheus_alert"
      alert_name: "charter_violation_detected"
      threshold: 1  # Alert on any violation
    - type: "webhook"
      url: "https://api.x0tta6bl4.io/api/v1/violations"
      retries: 3
      timeout_seconds: 10
    - type: "ebpf"
      enabled: true  # Phase 2+
      policy_name: "metric_collection_audit"
  
  metrics_export:
    enabled: true
    prometheus_port: 9090
    path: "/metrics"
    interval_seconds: 15

success_criteria:
  - "Zero CRITICAL/HIGH privacy violations in month 1"
  - "All forbidden metrics blocked 100% of attempts (99.99% SLA)"
  - "Audit trail immutable with crypto signatures"
  - "Audit committee access in <5 seconds (p99)"
  - "Emergency override renewable every 2 hours with DAO vote"
  - "Whistleblower reports processed within 24 hours"
  - "Zero data leaks to external services"
  - "All metrics properly anonymized/aggregated"
  - "100% audit trail coverage for 7 years"
  - "Network enforcement latency <1ms (eBPF)"

slas:
  availability:
    target_percent: 99.95
    measurement_window: "monthly"
  
  audit_access:
    target_latency_ms: 5000  # 5 seconds p99
    target_availability_percent: 99.9
  
  violation_detection:
    max_detection_latency_seconds: 1
    target_false_positive_rate: 0.0001

monitoring:
  dashboards:
    - name: "Charter Violations"
      url: "https://grafana.x0tta6bl4.io/d/charter-violations"
    - name: "Audit Committee Access"
      url: "https://grafana.x0tta6bl4.io/d/audit-access"
    - name: "Emergency Overrides"
      url: "https://grafana.x0tta6bl4.io/d/overrides"
  
  on_call_rotation: "security_team"
  pagerduty_service: "Charter_Violations"

changelog:
  - version: "1.0.0"
    date: "2026-01-11"
    status: "pending"
    author: "platform_team"
    approvers: []
    changes: "Initial production policy, submitted for board approval"
    approval_deadline: "2026-01-18"
