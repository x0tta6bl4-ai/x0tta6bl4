============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-8.4.2, pluggy-1.6.0 -- /usr/bin/python3
cachedir: .pytest_cache
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
hypothesis profile 'default' -> database=DirectoryBasedExampleDatabase(PosixPath('/mnt/projects/.hypothesis/examples'))
rootdir: /mnt/projects
configfile: pyproject.toml
plugins: asyncio-1.2.0, cov-7.0.0, xdist-3.8.0, anyio-4.12.0, mock-3.12.0, benchmark-5.1.0, hypothesis-6.98.15
asyncio: mode=Mode.STRICT, debug=False, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... collected 26 items

tests/test_ebpf_integration.py::TestEBPFIntegration::test_loader_orchestrator_integration PASSED [  3%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_orchestrator_lifecycle_management PASSED [  7%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_cli_loader_integration PASSED [ 11%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_full_system_integration FAILED [ 15%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_error_handling_integration PASSED [ 19%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_performance_monitoring_integration FAILED [ 23%]
tests/test_ebpf_integration.py::TestEBPFIntegration::test_configuration_persistence PASSED [ 26%]
tests/test_pqc_integration.py::TestEBPFPQCGateway::test_create_session PASSED [ 30%]
tests/test_pqc_integration.py::TestEBPFPQCGateway::test_get_session PASSED [ 34%]
tests/test_pqc_integration.py::TestEBPFPQCGateway::test_rotate_session_keys PASSED [ 38%]
tests/test_pqc_integration.py::TestEBPFPQCGateway::test_encrypt_decrypt_payload PASSED [ 42%]
tests/test_pqc_integration.py::TestEBPFPQCGateway::test_get_ebpf_map_data PASSED [ 46%]
tests/test_pqc_integration.py::TestPQCXDPLoader::test_loader_initialization PASSED [ 50%]
tests/test_pqc_integration.py::TestPQCXDPLoader::test_update_pqc_sessions PASSED [ 53%]
tests/test_pqc_integration.py::TestPQCXDPLoader::test_get_pqc_stats PASSED [ 57%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_monitor_healthy_system PASSED [ 61%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_analyze_no_issues PASSED [ 65%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_plan_no_action PASSED [ 69%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_execute_empty_plan PASSED [ 73%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_anomaly_detection PASSED [ 76%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_health_score_calculation PASSED [ 80%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_cleanup_expired_sessions PASSED [ 84%]
tests/test_pqc_integration.py::TestPQCZeroTrustHealer::test_rotate_expired_sessions PASSED [ 88%]
tests/test_pqc_integration.py::TestPQCSessionAnomaly::test_anomaly_creation PASSED [ 92%]
tests/test_pqc_integration.py::TestIntegration::test_full_healing_cycle PASSED [ 96%]
tests/test_pqc_integration.py::TestIntegration::test_gateway_loader_integration PASSED [100%]/home/x0ttta6bl4/.local/lib/python3.12/site-packages/coverage/report_core.py:107: CoverageWarning: Couldn't parse Python file '/mnt/projects/src/network/обновление_алгоритмов.py' (couldnt-parse); see https://coverage.readthedocs.io/en/7.13.0/messages.html#warning-couldnt-parse
  coverage._warn(msg, slug="couldnt-parse")

ERROR: Coverage failure: total of 4 is less than fail-under=75


=================================== FAILURES ===================================
_______________ TestEBPFIntegration.test_full_system_integration _______________
tests/test_ebpf_integration.py:188: in test_full_system_integration
    assert success is True
E   assert False is True
------------------------------ Captured log call -------------------------------
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_packets_processed_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_packets_dropped_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_processing_latency_microseconds
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_cpu_usage_percent
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_memory_usage_bytes
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_flows_active
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_errors_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_program_load_time_seconds
ERROR    src.network.ebpf.orchestrator:orchestrator.py:616 Failed to attach program: 'xdp' is not a valid EBPFAttachMode
_________ TestEBPFIntegration.test_performance_monitoring_integration __________
tests/test_ebpf_integration.py:239: in test_performance_monitoring_integration
    assert health.get("healthy") is True
E   assert False is True
E    +  where False = <built-in method get of dict object at 0x7548bd3f6fc0>('healthy')
E    +    where <built-in method get of dict object at 0x7548bd3f6fc0> = {'healthy': False, 'state': 'running', 'checks': {'loader': {'status': 'healthy', 'programs_loaded': 0}, 'probes': {'status': 'unhealthy', 'error': "'>' not supported between instances of 'MagicMock' and 'int'"}, 'cilium': {'status': 'healthy', 'flows_processed': <MagicMock name='CiliumLikeIntegration().get_flow_metrics().get()' id='128955503450912'>}}}.get
------------------------------ Captured log call -------------------------------
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_packets_processed_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_packets_dropped_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_processing_latency_microseconds
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_cpu_usage_percent
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_memory_usage_bytes
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_flows_active
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_errors_total
WARNING  src.network.ebpf.performance_monitor:performance_monitor.py:168 Prometheus not available, skipping metric: ebpf_program_load_time_seconds
----------------- generated xml file: /mnt/projects/junit.xml ------------------
================================ tests coverage ================================
_______________ coverage: platform linux, python 3.12.3-final-0 ________________

Coverage HTML written to dir htmlcov
Coverage XML written to file coverage.xml
FAIL Required test coverage of 75% not reached. Total coverage: 3.66%
=========================== short test summary info ============================
FAILED tests/test_ebpf_integration.py::TestEBPFIntegration::test_full_system_integration - assert False is True
FAILED tests/test_ebpf_integration.py::TestEBPFIntegration::test_performance_monitoring_integration - assert False is True
 +  where False = <built-in method get of dict object at 0x7548bd3f6fc0>('healthy')
 +    where <built-in method get of dict object at 0x7548bd3f6fc0> = {'healthy': False, 'state': 'running', 'checks': {'loader': {'status': 'healthy', 'programs_loaded': 0}, 'probes': {'status': 'unhealthy', 'error': "'>' not supported between instances of 'MagicMock' and 'int'"}, 'cilium': {'status': 'healthy', 'flows_processed': <MagicMock name='CiliumLikeIntegration().get_flow_metrics().get()' id='128955503450912'>}}}.get
======================== 2 failed, 24 passed in 29.50s =========================
