# –ü–æ—á–µ–º—É GraphSAGE –∏ Causal Analysis –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç ML-–º–æ–¥–µ–ª–∏?

**–î–∞—Ç–∞:** 2026-01-07  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ - —Ä–µ–∞–ª—å–Ω—ã–µ ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è

---

## üîç –ü–†–û–ë–õ–ï–ú–ê

–í –ø—Ä–æ–µ–∫—Ç–µ **–ï–°–¢–¨** —Ä–µ–∞–ª—å–Ω—ã–µ ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

### 1. GraphSAGEAnomalyDetector ‚úÖ
- **–§–∞–π–ª:** `src/ml/graphsage_anomaly_detector.py`
- **–†–µ–∞–ª—å–Ω–∞—è ML-–º–æ–¥–µ–ª—å:** GraphSAGE v2 —Å attention mechanism
- **–ú–µ—Ç–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** `detector.predict(node_id, node_features, neighbors)`
- **–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –º–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –≥—Ä–∞—Ñ–∞–º–∏

### 2. CausalAnalysisEngine ‚úÖ
- **–§–∞–π–ª:** `src/ml/causal_analysis.py`
- **–†–µ–∞–ª—å–Ω—ã–π ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç:** Causal graph construction + root cause analysis
- **–ú–µ—Ç–æ–¥ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:** `causal_engine.analyze(incident_id)`
- **–°—Ç–∞—Ç—É—Å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç NetworkX –¥–ª—è causal graphs

---

## ‚ùå –ß–¢–û –ù–ï –¢–ê–ö –í `drift_detector.py`

### –ü—Ä–æ–±–ª–µ–º–∞ 1: GraphSAGE –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 500-548):**
```python
# –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
# –í –ø–æ–ª–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ GraphSAGE –º–æ–¥–µ–ª–∏
if NUMPY_AVAILABLE:
    features_array = np.array(node_features)
    mean_features = np.mean(features_array, axis=0)
    std_features = np.std(features_array, axis=0)
    
    # –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É–∑–ª–æ–≤ —Å –Ω–µ–æ–±—ã—á–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
    for i, features in enumerate(node_features):
        z_scores = [(f - m) / (s + 1e-6) for f, m, s in zip(features, mean_features, std_features)]
        if any(abs(z) > 2.0 for z in z_scores):  # –ü—Ä–æ—Å—Ç–æ–π threshold
            anomalies.append({...})
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ (z-scores) –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–π ML-–º–æ–¥–µ–ª–∏!

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é GraphSAGE –º–æ–¥–µ–ª—å
if self.anomaly_detector and self.anomaly_detector.is_trained:
    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ ledger –≤ —Ñ–æ—Ä–º–∞—Ç –¥–ª—è GraphSAGE
    for node in graph["nodes"]:
        node_features = {
            "content_length": node["content_length"],
            "title_length": len(node["title"]),
            # ... –¥—Ä—É–≥–∏–µ —Ñ–∏—á–∏
        }
        
        # –í–´–ó–í–ê–¢–¨ –†–ï–ê–õ–¨–ù–£–Æ ML-–ú–û–î–ï–õ–¨
        prediction = self.anomaly_detector.predict(
            node_id=str(node["id"]),
            node_features=node_features,
            neighbors=[]  # –∏–ª–∏ —Å–æ—Å–µ–¥–∏ –∏–∑ –≥—Ä–∞—Ñ–∞
        )
        
        if prediction.is_anomaly:
            anomalies.append({
                "node_id": node["id"],
                "anomaly_score": prediction.anomaly_score,
                "confidence": prediction.confidence
            })
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Causal Analysis –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (—Å—Ç—Ä–æ–∫–∏ 550-582):**
```python
# –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è: –∞–Ω–∞–ª–∏–∑ —Å–≤—è–∑–µ–π –º–µ–∂–¥—É drifts
if len(all_drifts) > 1:
    # –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ drifts –ø–æ —Ç–∏–ø—É –∏ severity
    drift_groups = {}
    for drift in all_drifts:
        key = f"{drift.drift_type}_{drift.severity}"
        if key not in drift_groups:
            drift_groups[key] = []
        drift_groups[key].append(drift)
    
    # –ü–æ–∏—Å–∫ –æ–±—â–∏—Ö –ø—Ä–∏—á–∏–Ω (–±–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
    for group_key, group_drifts in drift_groups.items():
        if len(group_drifts) > 1:
            common_sections = set(d.section for d in group_drifts)
            if len(common_sections) > 0:
                root_causes.append({...})
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–æ—Å—Ç–∞—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ Causal Analysis Engine!

**–ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å:**
```python
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π Causal Analysis Engine
if self.causal_engine and all_drifts:
    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å drifts –≤ IncidentEvent
    for drift in all_drifts:
        incident = IncidentEvent(
            event_id=f"drift_{drift.drift_type}_{drift.detected_at}",
            timestamp=datetime.fromisoformat(drift.detected_at),
            node_id="ledger",
            service_id=None,
            anomaly_type=drift.drift_type,
            severity=drift.severity,
            metrics={"drift_count": 1},
            detected_by="drift_detector",
            anomaly_score=0.8 if drift.severity == "critical" else 0.5
        )
        
        # –î–û–ë–ê–í–ò–¢–¨ –í CAUSAL ENGINE
        self.causal_engine.add_incident(incident)
    
    # –í–´–ó–í–ê–¢–¨ –†–ï–ê–õ–¨–ù–´–ô CAUSAL ANALYSIS
    if len(all_drifts) > 0:
        result = self.causal_engine.analyze(all_drifts[0].event_id)
        root_causes = [
            {
                "type": rc.root_cause_type,
                "confidence": rc.confidence,
                "explanation": rc.explanation
            }
            for rc in result.root_causes
        ]
```

---

## üéØ –ü–†–ò–ß–ò–ù–ê –ü–†–û–ë–õ–ï–ú–´

1. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –≤—Ä–µ–º–µ–Ω–∏:** –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –±—ã–ª–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –±—ã—Å—Ç—Ä–æ –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è TODO
2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –ø–æ–Ω–∏–º–∞–Ω–∏—è:** –ù–µ –±—ã–ª–æ –ø–æ–ª–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
3. **–ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è:** –§–æ–∫—É—Å –±—ã–ª –Ω–∞ –∑–∞–∫—Ä—ã—Ç–∏–∏ TODO, –∞ –Ω–µ –Ω–∞ –ø–æ–ª–Ω–æ–π ML-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ–π—á–∞—Å (–µ—Å–ª–∏ –≤—Ä–µ–º—è –µ—Å—Ç—å)
- –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π `detector.predict()`
- –ó–∞–º–µ–Ω–∏—Ç—å –ø—Ä–æ—Å—Ç—É—é –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫—É –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π `causal_engine.analyze()`
- **–í—Ä–µ–º—è:** 2-3 —á–∞—Å–∞
- **–¶–µ–Ω–Ω–æ—Å—Ç—å:** –ü–æ–ª–Ω–∞—è ML-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 2: –û—Å—Ç–∞–≤–∏—Ç—å –∫–∞–∫ –µ—Å—Ç—å (–µ—Å–ª–∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç - –±–∏–∑–Ω–µ—Å)
- –ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç
- ML-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ (Jan 16-22)
- **–í—Ä–µ–º—è:** 0 —á–∞—Å–æ–≤
- **–¶–µ–Ω–Ω–æ—Å—Ç—å:** –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥ –∑–∞–∫—Ä—ã—Ç, –º–æ–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –±–∏–∑–Ω–µ—Å

---

## üìä –ß–ï–°–¢–ù–ê–Ø –û–¶–ï–ù–ö–ê

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç (–Ω–∞—Ö–æ–¥–∏—Ç –∞–Ω–æ–º–∞–ª–∏–∏ –∏ root causes)
- ‚ö†Ô∏è –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ ML-–º–æ–¥–µ–ª–∏
- ‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ—Å—Ç—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É/–ª–æ–≥–∏–∫—É

**–ü–æ–ª–Ω–∞—è ML-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è:**
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Ä–µ–∞–ª—å–Ω—ã–µ ML-–º–æ–¥–µ–ª–∏
- ‚úÖ –ë–æ–ª–µ–µ —Ç–æ—á–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –æ–±—É—á–µ–Ω–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π
- ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Å–ø—Ä–∏–Ω—Ç–∞:**
- ‚úÖ –ü—Ä–∏–Ω—è—Ç—å –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—é –∫–∞–∫ –µ—Å—Ç—å
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á–µ—Å—Ç–Ω–æ: "–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è, –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç ML"
- ‚úÖ –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –±–∏–∑–Ω–µ—Å-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã

**–î–ª—è –±—É–¥—É—â–µ–≥–æ (Jan 16-22, –µ—Å–ª–∏ –≤—Ä–µ–º—è):**
- üîß –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ ML-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
- üîß –î–æ–±–∞–≤–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö
- üîß –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å ML-–º–æ–¥–µ–ª–µ–π vs –±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è

---

**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞, —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ù–∏–∑–∫–∏–π (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç, ML-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–∑–∂–µ)

